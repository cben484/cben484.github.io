<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="PTXï¼ˆParallel Thread Executionï¼‰ 1 2 3 4 5 6 __device__ __forceinline__ int load_int_from_global(const int* a) { int r; asm volatile(&#34;ld.global.cs.s32 %0, [%1];&#34; : &#34;=r&#34;(r) : &#34;l&#34;(a)); return r; } DASP/src/dasp_f16.hä¸­çš„ä¾‹å­ï¼Œç”¨äº†ptxæŒ‡ä»¤\n\u200d\nè¿™ä¸ªä»£ç æ€»ä½“çš„æ„æ€æ˜¯ï¼Œæ ¹æ®è¾“å…¥çš„å‚æ•°aï¼Œaæ˜¯ä¸€ä¸ªæŒ‡å‘å…¨å±€å†…å­˜æ•°æ®çš„æŒ‡é’ˆï¼Œ\n">
<meta name="keywords" content="CUDA,PTX,æ±‡ç¼–"><title>PTXï¼ˆParallel Thread Executionï¼‰</title>

<link rel='canonical' href='https://cben484.github.io/post/ptx-parallel-thread-execution-2wylyv.html'>

<link rel="stylesheet" href="/scss/style.min.663803bebe609202d5b39d848f2d7c2dc8b598a2d879efa079fa88893d29c49c.css"><meta property='og:title' content="PTXï¼ˆParallel Thread Executionï¼‰">
<meta property='og:description' content="PTXï¼ˆParallel Thread Executionï¼‰ 1 2 3 4 5 6 __device__ __forceinline__ int load_int_from_global(const int* a) { int r; asm volatile(&#34;ld.global.cs.s32 %0, [%1];&#34; : &#34;=r&#34;(r) : &#34;l&#34;(a)); return r; } DASP/src/dasp_f16.hä¸­çš„ä¾‹å­ï¼Œç”¨äº†ptxæŒ‡ä»¤\n\u200d\nè¿™ä¸ªä»£ç æ€»ä½“çš„æ„æ€æ˜¯ï¼Œæ ¹æ®è¾“å…¥çš„å‚æ•°aï¼Œaæ˜¯ä¸€ä¸ªæŒ‡å‘å…¨å±€å†…å­˜æ•°æ®çš„æŒ‡é’ˆï¼Œ\n">
<meta property='og:url' content='https://cben484.github.io/post/ptx-parallel-thread-execution-2wylyv.html'>
<meta property='og:site_name' content='é’ç•Œ'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='CUDA' /><meta property='article:tag' content='PTX' /><meta property='article:tag' content='æ±‡ç¼–' /><meta property='article:published_time' content='2024-12-13T11:48:28&#43;08:00'/><meta property='article:modified_time' content='2025-02-23T20:00:02&#43;08:00'/>
<meta name="twitter:title" content="PTXï¼ˆParallel Thread Executionï¼‰">
<meta name="twitter:description" content="PTXï¼ˆParallel Thread Executionï¼‰ 1 2 3 4 5 6 __device__ __forceinline__ int load_int_from_global(const int* a) { int r; asm volatile(&#34;ld.global.cs.s32 %0, [%1];&#34; : &#34;=r&#34;(r) : &#34;l&#34;(a)); return r; } DASP/src/dasp_f16.hä¸­çš„ä¾‹å­ï¼Œç”¨äº†ptxæŒ‡ä»¤\n\u200d\nè¿™ä¸ªä»£ç æ€»ä½“çš„æ„æ€æ˜¯ï¼Œæ ¹æ®è¾“å…¥çš„å‚æ•°aï¼Œaæ˜¯ä¸€ä¸ªæŒ‡å‘å…¨å±€å†…å­˜æ•°æ®çš„æŒ‡é’ˆï¼Œ\n">
    <link rel="shortcut icon" href="/favicon.ico" />

    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="åˆ‡æ¢èœå•">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu_4db67dde559c71b8.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">ğŸŒŒ</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">é’ç•Œ</a></h1>
            <h2 class="site-description">å€¾çš„é’ç•Œ</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://github.com/cben484'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://twitter.com'
                        target="_blank"
                        title="Twitter"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>ä¸»é¡µ</span>
            </a>
        </li>
        
        
        <li >
            <a href='/%E5%85%B3%E4%BA%8E/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>å…³äº</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        
        
        <li >
            <a href='/links/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>Links</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">
                    
                        <li id="i18n-switch">  
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M4 5h7" />
  <path d="M9 3v2c0 4.418 -2.239 8 -5 8" />
  <path d="M5 9c-.003 2.144 2.952 3.908 6.7 4" />
  <path d="M12 20l4 -9l4 9" />
  <path d="M19.1 18h-6.2" />
</svg>



                            <select name="language" title="language" onchange="window.location.href = this.selectedOptions[0].value">
                                
                                    <option value="https://cben484.github.io/en/" >English</option>
                                
                                    <option value="https://cben484.github.io/" selected>ç®€ä½“ä¸­æ–‡</option>
                                
                                    <option value="https://cben484.github.io/ar/" >Ø¹Ø±Ø¨ÙŠ</option>
                                
                            </select>
                        </li>
                    
                

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>æš—è‰²æ¨¡å¼</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">ç›®å½•</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#1a-highly-multithreaded-coprocessor">1.A Highly Multithreaded Coprocessor</a></li>
    <li><a href="#2thread-hierarchyptxçš„çº¿ç¨‹å±‚æ¬¡ç»“æ„å’Œcudaçš„ä¸ä¸€æ ·cudaé‡Œé¢å«åšblockè¿™é‡Œå«åšctaçœŸæ˜¯æœäº†">2.Thread Hierarchy<sup>(ptxçš„çº¿ç¨‹å±‚æ¬¡ç»“æ„å’Œcudaçš„ä¸ä¸€æ ·ï¼Œcudaé‡Œé¢å«åšblockï¼Œè¿™é‡Œå«åšCTAï¼ˆçœŸæ˜¯æœäº†ï¼‰)</sup></a>
      <ol>
        <li><a href="#21-cooperative-thread-arrays">2.1 Cooperative Thread Arrays</a></li>
        <li><a href="#22-cluster-of-cooperative-thread-arraysæœ‰blockå°±æœ‰block-clusteræœ‰ctaå°±æœ‰cta-cluster">2.2 Cluster of Cooperative Thread Arrays<sup>(æœ‰blockå°±æœ‰block clusterï¼Œæœ‰CTAå°±æœ‰CTA cluster)</sup></a></li>
        <li><a href="#23-grid-of-clustersæœ‰blockå°±æœ‰gridä»–è¿™é‡Œå†™çš„æ˜¯grid-of-clusters">2.3 Grid of Clusters<sup>(æœ‰blockå°±æœ‰gridï¼Œä»–è¿™é‡Œå†™çš„æ˜¯grid of clusters)</sup></a></li>
      </ol>
    </li>
    <li><a href="#3-memory-hierarchyç´¯äº†æ˜å¤©å†çœ‹è¿™ä¸ª">3. Memory Hierarchy<sup>(ç´¯äº†ï¼Œæ˜å¤©å†çœ‹è¿™ä¸ª)</sup></a></li>
  </ol>

  <ol>
    <li><a href="#1source-format">1.Source Format</a></li>
    <li><a href="#2commentsptxçš„æ³¨é‡Šè§„åˆ™å’ŒccppåŸºæœ¬ä¸Šæ˜¯ä¸€æ ·çš„ä¸ä¸€æ ·çš„ç‚¹å‹¾ç”»å‡ºæ¥äº†">2.Comments<sup>(ptxçš„æ³¨é‡Šè§„åˆ™ï¼Œå’ŒC/CPPåŸºæœ¬ä¸Šæ˜¯ä¸€æ ·çš„ï¼Œä¸ä¸€æ ·çš„ç‚¹å‹¾ç”»å‡ºæ¥äº†)</sup></a></li>
    <li><a href="#3statementsè¯­å¥">3.Statements<sup>(è¯­å¥)</sup></a>
      <ol>
        <li><a href="#31-directive-statements">3.1 Directive Statements</a></li>
        <li><a href="#32-instruction-statementsæ“ä½œç æ“ä½œæ•°æ“ä½œæ•°ä»¥é€—å·åˆ†éš”ä»¥åˆ†å·ç»“æŸ">3.2 Instruction Statements<sup>(æ“ä½œç +æ“ä½œæ•°ï¼ˆæ“ä½œæ•°ä»¥é€—å·åˆ†éš”ï¼Œä»¥åˆ†å·ç»“æŸï¼‰)</sup></a></li>
      </ol>
    </li>
    <li><a href="#4identifiersæ ‡è¯†ç¬¦">4.Identifiers<sup>(æ ‡è¯†ç¬¦)</sup></a></li>
    <li><a href="#5constants">5.Constants</a>
      <ol>
        <li><a href="#51-integer-constants">5.1 Integer Constants</a></li>
        <li><a href="#52-floating-point-constants">5.2 Floating-Point Constants</a></li>
        <li><a href="#53-predicate-è°“è¯æœ‰ç‚¹é™Œç”Ÿçš„è¯æ±‡-è°“è¯predicateæ˜¯ä¸€ä¸ªé€»è¾‘æˆ–æ¡ä»¶åˆ¤æ–­çš„æœ¯è¯­é€šå¸¸è¡¨ç¤ºä¸€ç§åˆ¤æ–­å¼æˆ–æ¡ä»¶ç”¨äºåˆ¤æ–­æŸä¸ªç‰¹å®šçš„æ¡ä»¶æ˜¯å¦æˆç«‹åœ¨ç¼–ç¨‹è¯­è¨€ä¸­è°“è¯é€šå¸¸æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼å…¶å€¼ä¸ºçœŸæˆ–å‡true-æˆ–-false-åœ¨-ptx-è¿™æ ·çš„æ±‡ç¼–è¯­è¨€ä¸­è°“è¯å¸¸å¸¸ç”¨äºæ§åˆ¶ç¨‹åºçš„æ‰§è¡Œæµç¨‹ä¾‹å¦‚åœ¨æŸäº›æŒ‡ä»¤çš„æ‰§è¡Œä¸Šè¿›è¡Œæ¡ä»¶åˆ¤æ–­--å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç®€å•çš„æ¡ä»¶è¯­å¥-if-x--5-------æ‰§è¡ŒæŸäº›æ“ä½œ--åœ¨è¿™é‡Œx--5-å°±æ˜¯ä¸€ä¸ªè°“è¯å®ƒçš„å€¼æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼true-æˆ–-falseå¦‚æœ-x-çš„å€¼å¤§äº-5è°“è¯-x--5-ä¸º-trueé‚£ä¹ˆå°±ä¼šæ‰§è¡Œåé¢çš„æ“ä½œå¦‚æœ-x-å°äºæˆ–ç­‰äº-5è°“è¯ä¸º-falseæ“ä½œå°±ä¸ä¼šæ‰§è¡Œ--åœ¨-ptx-ä¸­çš„åº”ç”¨-åœ¨-ptx-æ±‡ç¼–ä¸­æ•´æ•°å¸¸é‡å¯ä»¥ä½œä¸ºè°“è¯ä½¿ç”¨å…·ä½“æ¥è¯´0-è¢«è§†ä¸º-falseéé›¶æ•´æ•°æ¯”å¦‚-1è¢«è§†ä¸º-trueä¾‹å¦‚-setpequ32--p0-r1-0----p0-ä¸º-1-æ—¶ç›¸å½“äº-trueè¡¨ç¤º-r1-æ˜¯å¦ç­‰äº-0-åœ¨è¿™é‡Œsetpequ32-æŒ‡ä»¤æ¯”è¾ƒå¯„å­˜å™¨-r1-å’Œ-0-æ˜¯å¦ç›¸ç­‰å¦‚æœç›¸ç­‰p0-è¢«è®¾ç½®ä¸º-1trueå¦åˆ™-p0-è¢«è®¾ç½®ä¸º-0falsep0-å°±æ˜¯ä¸€ä¸ªè°“è¯ç”¨æ¥è¡¨ç¤ºæ¡ä»¶æ˜¯å¦æˆç«‹constants">5.3 Predicate <sup>(è°“è¯ï¼Œæœ‰ç‚¹é™Œç”Ÿçš„è¯æ±‡ã€‚ è°“è¯ï¼ˆPredicateï¼‰æ˜¯ä¸€ä¸ªé€»è¾‘æˆ–æ¡ä»¶åˆ¤æ–­çš„æœ¯è¯­ï¼Œé€šå¸¸è¡¨ç¤ºä¸€ç§â€œåˆ¤æ–­å¼â€æˆ–â€œæ¡ä»¶â€ï¼Œç”¨äºåˆ¤æ–­æŸä¸ªç‰¹å®šçš„æ¡ä»¶æ˜¯å¦æˆç«‹ã€‚åœ¨ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œè°“è¯é€šå¸¸æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œå…¶å€¼ä¸ºçœŸæˆ–å‡ï¼ˆTrue æˆ– Falseï¼‰ã€‚ åœ¨ PTX è¿™æ ·çš„æ±‡ç¼–è¯­è¨€ä¸­ï¼Œè°“è¯å¸¸å¸¸ç”¨äºæ§åˆ¶ç¨‹åºçš„æ‰§è¡Œæµç¨‹ï¼Œä¾‹å¦‚åœ¨æŸäº›æŒ‡ä»¤çš„æ‰§è¡Œä¸Šè¿›è¡Œæ¡ä»¶åˆ¤æ–­ã€‚  å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç®€å•çš„æ¡ä»¶è¯­å¥ï¼š if (x &gt; 5) {     // æ‰§è¡ŒæŸäº›æ“ä½œ } åœ¨è¿™é‡Œï¼Œx &gt; 5 å°±æ˜¯ä¸€ä¸ªè°“è¯ï¼Œå®ƒçš„å€¼æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼ˆTrue æˆ– Falseï¼‰ã€‚å¦‚æœ x çš„å€¼å¤§äº 5ï¼Œè°“è¯ x &gt; 5 ä¸º Trueï¼Œé‚£ä¹ˆå°±ä¼šæ‰§è¡Œåé¢çš„æ“ä½œï¼›å¦‚æœ x å°äºæˆ–ç­‰äº 5ï¼Œè°“è¯ä¸º Falseï¼Œæ“ä½œå°±ä¸ä¼šæ‰§è¡Œã€‚  åœ¨ PTX ä¸­çš„åº”ç”¨ï¼š åœ¨ PTX æ±‡ç¼–ä¸­ï¼Œæ•´æ•°å¸¸é‡å¯ä»¥ä½œä¸ºè°“è¯ä½¿ç”¨ã€‚å…·ä½“æ¥è¯´ï¼Œ0 è¢«è§†ä¸º Falseï¼Œéé›¶æ•´æ•°ï¼ˆæ¯”å¦‚ 1ï¼‰è¢«è§†ä¸º Trueã€‚ä¾‹å¦‚ï¼š setp.eq.u32  p0, r1, 0;   // p0 ä¸º 1 æ—¶ï¼Œç›¸å½“äº Trueï¼Œè¡¨ç¤º r1 æ˜¯å¦ç­‰äº 0 åœ¨è¿™é‡Œï¼Œsetp.eq.u32 æŒ‡ä»¤æ¯”è¾ƒå¯„å­˜å™¨ $r1 å’Œ 0 æ˜¯å¦ç›¸ç­‰ï¼Œå¦‚æœç›¸ç­‰ï¼Œp0 è¢«è®¾ç½®ä¸º 1ï¼ˆTrueï¼‰ï¼Œå¦åˆ™ p0 è¢«è®¾ç½®ä¸º 0ï¼ˆFalseï¼‰ã€‚p0 å°±æ˜¯ä¸€ä¸ªè°“è¯ï¼Œç”¨æ¥è¡¨ç¤ºæ¡ä»¶æ˜¯å¦æˆç«‹ã€‚)</sup>Constants</a></li>
        <li><a href="#54-constant-expressions">5.4 Constant Expressions</a></li>
        <li><a href="#55-integer-constant-expression-evaluation">5.5 Integer Constant Expression Evaluation</a></li>
        <li><a href="#56-summary-of-constant-expression-evaluation-rules">5.6 Summary of Constant Expression Evaluation Rules</a></li>
      </ol>
    </li>
  </ol>

  <ol>
    <li><a href="#1-state-spaces">1. State Spaces</a>
      <ol>
        <li><a href="#11-register-state-space">1.1 Register State Space</a></li>
        <li><a href="#12-special-register-state-spaceå­˜äº†ä¸€äº›é¢„å®šä¹‰çš„ç‰¹å®šå¹³å°çš„å¯„å­˜å™¨å¦‚ç½‘æ ¼é›†ç¾¤ctaå’Œçº¿ç¨‹å‚æ•°æ—¶é’Ÿè®¡æ•°å™¨ä»¥åŠæ€§èƒ½ç›‘æ§å¯„å­˜å™¨æ‰€æœ‰ç‰¹æ®Šå¯„å­˜å™¨éƒ½æ˜¯é¢„å®šä¹‰çš„">1.2 Special Register State Space<sup>(å­˜äº†ä¸€äº›é¢„å®šä¹‰çš„ç‰¹å®šå¹³å°çš„å¯„å­˜å™¨ï¼Œå¦‚ç½‘æ ¼ã€é›†ç¾¤ã€CTAå’Œçº¿ç¨‹å‚æ•°ã€æ—¶é’Ÿè®¡æ•°å™¨ä»¥åŠæ€§èƒ½ç›‘æ§å¯„å­˜å™¨ã€‚æ‰€æœ‰ç‰¹æ®Šå¯„å­˜å™¨éƒ½æ˜¯é¢„å®šä¹‰çš„)</sup></a></li>
        <li><a href="#13-constant-state-space">1.3 Constant State Space</a>
          <ol>
            <li><a href="#131-banked-constant-state-spacedeprecated">1.3.1 Banked Constant State Spaceï¼ˆdeprecatedï¼‰</a></li>
          </ol>
        </li>
        <li><a href="#14-global-state-space">1.4 Global State Space</a></li>
        <li><a href="#15-local-state-space">1.5 Local State Space</a></li>
        <li><a href="#16-parameter-state-space">1.6 Parameter State Space</a>
          <ol>
            <li><a href="#161-kernel-function-parameters">1.6.1 Kernel Function Parameters</a></li>
            <li><a href="#162-kernel-function-parameter-attributeså¯ä»¥ç”¨ptræ¥è¡¨æ˜è¯¥å‚æ•°æ˜¯æŒ‡å‘å†…å­˜çš„æŒ‡é’ˆè¿˜å¯ä»¥æŒ‡ç¤ºè¯¥æŒ‡é’ˆæ‰€æŒ‡å‘å†…å­˜çš„çŠ¶æ€ç©ºé—´å’Œå¯¹é½æ–¹å¼">1.6.2 Kernel Function Parameter Attributes<sup>(å¯ä»¥ç”¨.ptræ¥è¡¨æ˜è¯¥å‚æ•°æ˜¯æŒ‡å‘å†…å­˜çš„æŒ‡é’ˆï¼Œè¿˜å¯ä»¥æŒ‡ç¤ºè¯¥æŒ‡é’ˆæ‰€æŒ‡å‘å†…å­˜çš„çŠ¶æ€ç©ºé—´å’Œå¯¹é½æ–¹å¼)</sup></a></li>
            <li><a href="#163-kernel-parameter-attributeptr">1.6.3 Kernel Parameter Attributeï¼š.ptr</a></li>
            <li><a href="#164-device-function-parameters">1.6.4 Device Function Parameters</a></li>
          </ol>
        </li>
        <li><a href="#17-shared-state-space">1.7 Shared State Space</a></li>
        <li><a href="#18-texture-state-spacedeprecated">1.8 Texture State Spaceï¼ˆdeprecatedï¼‰</a></li>
      </ol>
    </li>
    <li><a href="#2-tpyes">2. Tpyes</a>
      <ol>
        <li><a href="#21-fundamental-types">2.1 Fundamental Types</a></li>
        <li><a href="#22-restricted-use-of-sub-word-sizes">2.2 Restricted Use of Sub-Word Sizes</a></li>
        <li><a href="#23-alternate-floating-point-data-formats">2.3 Alternate Floating-Point Data Formats</a></li>
        <li><a href="#24-packed-data-types">2.4 Packed Data Types</a>
          <ol>
            <li><a href="#241-packed-floating-point-data-types">2.4.1 Packed Floating Point Data Types</a></li>
            <li><a href="#242-packed-integer-data-types">2.4.2 Packed Integer Data Types</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#3-texture-sampler-and-surface-typesä¼¼ä¹ä¸æ•°å€¼è®¡ç®—è¿™ä¸ªæ–¹å‘æ²¡æœ‰å¤ªå¤§çš„å…³ç³»æš‚ä¸”æ²¡çœ‹ä½†æ˜¯ä¸ºäº†ä¿æŒptxå­¦ä¹ çš„å®Œæ•´æ€§è¿˜æ˜¯cväº†ä¸Šå»">3. Texture Sampler and Surface Types<sup>(ä¼¼ä¹ä¸æ•°å€¼è®¡ç®—è¿™ä¸ªæ–¹å‘æ²¡æœ‰å¤ªå¤§çš„å…³ç³»ï¼Œæš‚ä¸”æ²¡çœ‹ï¼Œä½†æ˜¯ä¸ºäº†ä¿æŒPTXå­¦ä¹ çš„å®Œæ•´æ€§ï¼Œè¿˜æ˜¯CVäº†ä¸Šå»)</sup></a>
      <ol>
        <li><a href="#31-texture-and-surface-properties">3.1 Texture and Surface Properties</a></li>
        <li><a href="#32-sampler-properties">3.2 Sampler Properties</a></li>
        <li><a href="#33-channel-data-type-and-channel-order-fields">3.3 Channel Data Type and Channel Order Fields</a></li>
      </ol>
    </li>
    <li><a href="#4-variables">4. Variables</a>
      <ol>
        <li><a href="#41-variable-declarations">4.1 Variable Declarations</a></li>
        <li><a href="#42-vectors">4.2 Vectors</a></li>
        <li><a href="#43-array-declarations">4.3 Array Declarations</a></li>
        <li><a href="#44-initializers">4.4 Initializers</a></li>
      </ol>
    </li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/post/ptx-parallel-thread-execution-2wylyv.html">PTXï¼ˆParallel Thread Executionï¼‰</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Dec 13, 2024</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    é˜…è¯»æ—¶é•¿: 41 åˆ†é’Ÿ
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <h1 id="ptxparallel-thread-execution">PTXï¼ˆParallel Thread Executionï¼‰
</h1><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">__device__</span> <span class="n">__forceinline__</span> <span class="ne">int</span> <span class="n">load_int_from_global</span><span class="p">(</span><span class="k">const</span> <span class="ne">int</span><span class="o">*</span> <span class="n">a</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="ne">int</span> <span class="n">r</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">asm</span> <span class="n">volatile</span><span class="p">(</span><span class="s2">&#34;ld.global.cs.s32 %0, [%1];&#34;</span> <span class="p">:</span> <span class="s2">&#34;=r&#34;</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="p">:</span> <span class="s2">&#34;l&#34;</span><span class="p">(</span><span class="n">a</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">r</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>DASP/src/dasp_f16.hä¸­çš„ä¾‹å­ï¼Œç”¨äº†ptxæŒ‡ä»¤</p>
<p>â€</p>
<ul>
<li>
<p>è¿™ä¸ªä»£ç æ€»ä½“çš„æ„æ€æ˜¯ï¼Œæ ¹æ®è¾“å…¥çš„å‚æ•°aï¼Œaæ˜¯ä¸€ä¸ªæŒ‡å‘å…¨å±€å†…å­˜æ•°æ®çš„æŒ‡é’ˆï¼Œ</p>
<p>é€šè¿‡è°ƒç”¨ptxæŒ‡ä»¤ï¼Œå°†è¿™ä¸ªæ•°æ®ç›´æ¥å­˜å…¥åˆ°å¯„å­˜å™¨ä¸­ç”¨äº†æ“ä½œæ•°çº¦æŸ&quot;=r(r)&ldquo;å°†rä¸å¯„å­˜å™¨ç›¸ç»‘å®šï¼Œæ‰€ä»¥ptxå°†æ•°æ®æ”¾å…¥å¯„å­˜å™¨çš„æ—¶å€™ï¼Œrå°±å·²ç»æœ‰å€¼äº†</p>
<p>æ­¤æ—¶å†è¿”å›rï¼Œå°±å®Œæˆäº†è¿™ä¸ªload from globalçš„æ“ä½œäº†</p>
</li>
<li>
<p>ld.global.cs.s32ï¼šld.globalè¡¨ç¤ºä»å…¨å±€å†…å­˜ä¸­åŠ è½½æ•°æ®ï¼Œcs(cache streaming)è¡¨ç¤ºç¼“å­˜ç­–ç•¥ï¼Œä¼˜åŒ–ä¸€æ¬¡æ€§åŠ è½½æ•°æ®çš„æ€§èƒ½ã€‚s32è¡¨ç¤ºåŠ è½½çš„æ•°æ®ç±»å‹æ˜¯32ä½æœ‰ç¬¦å·æ•°ã€‚</p>
</li>
<li>
<p>asmæ˜¯assemblyï¼ˆæ±‡ç¼–ï¼‰çš„ç¼©å†™ï¼Œç”¨äºåœ¨é«˜å±‚è¯­è¨€ï¼ˆC++æˆ–CUDAï¼‰ä¸­æ’å…¥åº•å±‚æ±‡ç¼–ä»£ç ï¼Œåœ¨CUDAä¸­ï¼Œç”¨äºåµŒå…¥PTXæ±‡ç¼–æŒ‡ä»¤ã€‚</p>
</li>
<li>
<p>volatileæ˜¯ä¸€ä¸ªä¿®é¥°ç¬¦ï¼Œè¡¨ç¤ºæ±‡ç¼–æŒ‡ä»¤å¯èƒ½è¢«ä¿®æ”¹ï¼Œé˜²æ­¢ç¼–è¯‘å™¨ä¼˜åŒ–æˆ–é‡æ–°æ’åº</p>
</li>
<li>
<p>asmå’Œvolatileç»„åˆè¡¨ç¤ºï¼Œç¡®ä¿åµŒå…¥çš„æ±‡ç¼–ä»£ç åœ¨ä»»ä½•ä¼˜åŒ–æƒ…å†µä¸‹éƒ½è¢«æ‰§è¡Œã€‚</p>
</li>
</ul>
<p>â€</p>
<p>è¿™é‡Œçš„=ræ˜¯çº¦æŸä¿®é¥°ç¬¦ï¼Œå°†rå˜é‡çº¦æŸåˆ°å¯„å­˜å™¨ä¸Šï¼Œç»‘å®šåˆ°å¯„å­˜å™¨ä¸Š</p>
<ul>
<li>
<p>å¯„å­˜å™¨çº¦æŸï¼Œ=r(r)ï¼Œrè¢«åˆ†é…åˆ°ä¸€ä¸ªå¯„å­˜å™¨</p>
<p>PTXæŒ‡ä»¤ä¼šå°†å…¨å±€å†…å­˜ä¸­åŠ è½½çš„å€¼å­˜å‚¨åˆ°è¿™ä¸ªå¯„å­˜å™¨</p>
<p>æœ‰ç­‰å·å’Œæ²¡æœ‰ç­‰å·æ˜¯æœ‰åŒºåˆ«çš„ï¼Œ=è¡¨ç¤ºè¾“å‡ºæ“ä½œæ•°ï¼Œè¯¥å˜é‡çš„å€¼å°†åœ¨æ±‡ç¼–æ‰§è¡Œåè¢«æ›´æ–°ï¼Œæ²¡æœ‰=è¡¨ç¤ºè¾“å…¥æ“ä½œæ•°ï¼Œè¯¥å˜é‡çš„å€¼åœ¨æ±‡ç¼–æŒ‡ä»¤ä¸­ä½œä¸ºåªè¯»æ•°æ®ï¼Œä¸ä¼šè¢«ä¿®æ”¹ã€‚</p>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">ä¾‹å­ï¼šasm volatile(&#34;ld.global.cs.u32 %0, [%1];&#34; : &#34;=r&#34;(r) : &#34;l&#34;(a));
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>å†…å­˜çº¦æŸï¼Œmï¼ŒPTXæŒ‡ä»¤å°†å¯„å­˜å™¨ä¸­çš„å€¼å­˜å‚¨åˆ°outputæŒ‡å®šçš„å†…å­˜åœ°å€</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">ä¾‹å­ï¼šasm volatile(&#34;st.global.u32 [%0], %1;&#34; : : &#34;m&#34;(output), &#34;r&#34;(value));
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>ç«‹å³æ•°çº¦æŸï¼Œiï¼Œè¡¨ç¤ºå˜é‡éœ€è¦ç»‘å®šåˆ°ä¸€ä¸ªç«‹å³æ•°ï¼ˆå¸¸é‡ï¼‰ï¼ŒPTX æŒ‡ä»¤å°†æ‰§è¡ŒæŒ‰ä½å·¦ç§»æ“ä½œã€‚</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">ä¾‹å­ï¼šasm volatile(&#34;shl.b32 %0, %1, %2;&#34; : &#34;=r&#34;(result) : &#34;r&#34;(value), &#34;i&#34;(shift));
</span></span></code></pre></td></tr></table>
</div>
</div><p>â€</p>
<p>åœ¨ä»¥ä¸‹ä¸¤ä¸ªä¾‹å­ä¸­ï¼Œå‡ºç°äº†æœ‰å•ä¸ªå†’å·å’ŒåŒå†’å·çš„æƒ…å†µï¼Œå¤šäº†è§£äº†ä¸€ä¸‹ï¼š</p>
<p>è¿™ä¸ªå†’å·å®è´¨ä¸Šæ˜¯ç”¨äºåˆ†éš”è¾“å‡ºæ“ä½œæ•°å’Œè¾“å…¥æ“ä½œæ•°çš„ï¼Œå‰è€…ä¸ºè¾“å‡ºæ“ä½œæ•°ï¼Œåè€…ä¸ºè¾“å…¥æ“ä½œæ•°ï¼Œåœ¨ç¬¬äºŒä¾‹å­ä¸­ï¼Œå‡½æ•°å®ç°çš„åŠŸèƒ½æ˜¯storeæ“ä½œï¼Œæ˜¯voidæ²¡æœ‰è¾“å‡ºï¼Œæ‰€ä»¥æ²¡æœ‰è¾“å‡ºæ“ä½œæ•°ï¼Œè‡ªç„¶å°±å½¢æˆäº†ä¸¤ä¸ªå†’å·äº†ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">__device__</span> <span class="n">__forceinline__</span> <span class="n">half</span> <span class="n">load_half_from_global</span><span class="p">(</span><span class="k">const</span> <span class="n">half</span><span class="o">*</span> <span class="n">a</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">ushort</span> <span class="n">r</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">asm</span> <span class="n">volatile</span><span class="p">(</span><span class="s2">&#34;ld.global.cs.u16 %0, [%1];&#34;</span> <span class="p">:</span> <span class="s2">&#34;=h&#34;</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="p">:</span> <span class="s2">&#34;l&#34;</span><span class="p">(</span><span class="n">a</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="n">half</span> <span class="o">*</span><span class="n">r_half</span> <span class="o">=</span> <span class="n">reinterpret_cast</span><span class="o">&lt;</span><span class="n">half</span> <span class="o">*&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">r</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="o">*</span><span class="n">r_half</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">__device__</span> <span class="n">__forceinline__</span> <span class="n">void</span> <span class="n">store_half_to_global</span><span class="p">(</span><span class="k">const</span> <span class="n">half</span><span class="o">*</span> <span class="n">a</span><span class="p">,</span> <span class="n">half</span> <span class="n">v</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">ushort</span> <span class="o">*</span><span class="n">v_u</span> <span class="o">=</span> <span class="n">reinterpret_cast</span><span class="o">&lt;</span><span class="n">ushort</span> <span class="o">*&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">v</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">asm</span> <span class="n">volatile</span><span class="p">(</span><span class="s2">&#34;st.global.cs.u16 [%0], %1;&#34;</span> <span class="p">::</span> <span class="s2">&#34;l&#34;</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="s2">&#34;h&#34;</span><span class="p">(</span><span class="o">*</span><span class="n">v_u</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>â€</p>
<hr>
<h1 id="ptx-introduction"><span data-type="text" style="background-color: var(--b3-font-background4);">PTX Introduction</span>
</h1><p><em>PTX</em>â€‹ defines a virtual machine and ISA for general purpose parallel thread execution. PTX programs are translated at install time to the target hardware instruction set. The PTX-to-GPU translator and driver enable NVIDIA GPUs to <sup>(ptxæä¾›äº†ä¸€ä¸ªè™šæ‹Ÿæœºå’ŒæŒ‡ä»¤é›†æ¶æ„ï¼ŒPTXåˆ°GPUçš„ç¼–è¯‘å™¨å’Œé©±åŠ¨ä½¿å¾—è‹±ä¼Ÿè¾¾GPUèƒ½å¤Ÿä½œä¸ºå¯ç¼–ç¨‹çš„å¹¶è¡Œè®¡ç®—æœºä½¿ç”¨)</sup>â€‹be used as programmable parallel computers.<sup>(ptxæä¾›äº†ä¸€ä¸ªè™šæ‹Ÿæœºå’ŒæŒ‡ä»¤é›†æ¶æ„ï¼ŒPTXåˆ°GPUçš„ç¼–è¯‘å™¨å’Œé©±åŠ¨ä½¿å¾—è‹±ä¼Ÿè¾¾GPUèƒ½å¤Ÿä½œä¸ºå¯ç¼–ç¨‹çš„å¹¶è¡Œè®¡ç®—æœºä½¿ç”¨)</sup></p>
<p>â€</p>
<hr>
<h1 id="ptx-programming-model"><span data-type="text" style="background-color: var(--b3-font-background4);">PTX Programming Model</span>
</h1><h2 id="1a-highly-multithreaded-coprocessor">1.A Highly Multithreaded Coprocessor
</h2><p>The GPU is a compute device capable of executing a very large number of threads in parallel. It operates as a coprocessor to the main CPU, or host: In other words, data-parallel, compute-intensive portions of applications running on the host are off-loaded onto the device.</p>
<p>More precisely, a portion of an application that is executed many times, but independently on different data, can be isolated into a kernel function that is executed on the GPU as many different threads. To that effect, such a function is compiled to the PTX instruction set and the resulting kernel is translated at install time to the target GPU instruction set.</p>
<h2 id="2thread-hierarchyptxçš„çº¿ç¨‹å±‚æ¬¡ç»“æ„å’Œcudaçš„ä¸ä¸€æ ·cudaé‡Œé¢å«åšblockè¿™é‡Œå«åšctaçœŸæ˜¯æœäº†">2.Thread Hierarchy<sup>(ptxçš„çº¿ç¨‹å±‚æ¬¡ç»“æ„å’Œcudaçš„ä¸ä¸€æ ·ï¼Œcudaé‡Œé¢å«åšblockï¼Œè¿™é‡Œå«åšCTAï¼ˆçœŸæ˜¯æœäº†ï¼‰)</sup>
</h2><p>The batch of threads that executes a kernel is organized as a grid. A grid consists of either cooperative thread arrays or clusters of cooperative thread arrays as described in this section and illustrated in <a class="link" href="https://docs.nvidia.com/cuda/parallel-thread-execution/index.html#grid-of-clusters-grid-with-ctas"  target="_blank" rel="noopener"
    >Figure 1</a> and <a class="link" href="https://docs.nvidia.com/cuda/parallel-thread-execution/index.html#grid-of-clusters-grid-with-clusters"  target="_blank" rel="noopener"
    >Figure 2</a>. *Cooperative thread arrays (CTAs)<sup>(æ‰€ä»¥å¯ä»¥ç›´æ¥å°†CTAè§†ä¸ºblockï¼Œclustersè§†ä¸ºblock clustersæ˜¯å§)</sup>*â€‹ implement CUDA thread blocks and clusters implement CUDA thread block clusters.<sup>(æ‰€ä»¥å¯ä»¥ç›´æ¥å°†CTAè§†ä¸ºblockï¼Œclustersè§†ä¸ºblock clustersæ˜¯å§)</sup></p>
<h3 id="21-cooperative-thread-arrays">2.1 Cooperative Thread Arrays
</h3><p>The <em>Parallel Thread Execution (PTX)</em>  programming model is explicitly parallel: a PTX program specifies the execution of a given thread of a parallel thread array. A <em>cooperative thread array</em>, or CTA, is an array of threads that execute a kernel concurrently or in parallel.</p>
<p>Threads within a CTA can communicate with each other. To coordinate the communication of the threads within the CTA, one can specify synchronization points where threads wait until all threads in the CTA have arrived.<sup>(æŒ‡å‡ºï¼Œä¸ºäº†åè°ƒCTAå†…éƒ¨çº¿ç¨‹çš„é€šä¿¡ï¼Œå¯ä»¥æŒ‡å®šåŒæ­¥ç‚¹ã€‚ æŒ‡æ˜äº†åŒæ­¥çš„ä½œç”¨ä¹‹ä¸€æ˜¯ä¸ºäº†CTAå†…éƒ¨çº¿ç¨‹çš„é€šä¿¡ã€‚)</sup></p>
<p>Each thread has a unique thread identifier within the CTA. Programs use a data parallel decomposition to partition inputs, work, and results across the threads of the CTA. Each CTA thread uses its thread identifier to determine its assigned role, assign specific input and output positions, compute addresses, and select work to perform.<sup>(ç¨‹åºå‘˜é€šè¿‡çº¿ç¨‹æ ‡è¯†ç¬¦ï¼Œå³tidï¼Œæ¥æ§åˆ¶CTAçº¿ç¨‹çš„è¡Œä¸º )</sup> The thread identifier is a three-element vector <code>tid</code>â€‹, (with elements <code>tid.x</code>â€‹, <code>tid.y</code>â€‹, and <code>tid.z</code>â€‹) that specifies the threadâ€™s position within a 1D, 2D, or 3D CTA. Each thread identifier component ranges from zero up to the number of thread ids in that CTA dimension.</p>
<p>Each CTA has a 1D, 2D, or 3D shape specified by a three-element vector â€‹ntidâ€‹ (with elements â€‹ntid.xâ€‹, â€‹ntid.yâ€‹, and â€‹ntid.zâ€‹). <sup>(ntidæŒ‡å®šäº†CTAçš„shape )</sup>The vector <code>ntid</code>â€‹ specifies the number of threads in each CTA dimension.</p>
<p>Threads within a CTA execute in SIMT (single-instruction, multiple-thread) fashion in groups called â€‹<em>warps</em>â€‹.<sup>(è¿™å¥è¯æ˜ç¡®è¯´äº†ï¼Œwarpé‡Œé¢çš„çº¿ç¨‹çš„æ‰§è¡Œæ–¹å¼å°±æ˜¯SIMT)</sup> A <em>warp</em> is a maximal subset of threads from a single CTA, such that the threads execute the same instructions at the same time. Threads within a warp are sequentially numbered. The warp size is a machine-dependent constant. Typically, a warp has 32 threads. <sup>(ä»–è¿™æ ·è¯´çš„ï¼Œæ„Ÿè§‰warpçš„å¤§å°æœ‰å¯èƒ½éšç€æœªæ¥çš„å‘å±•è€Œå˜åŒ–)</sup>Some applications may be able to maximize performance with knowledge of the warp size, so PTX includes a run-time immediate constant, <code>WARP_SZ</code>â€‹, which may be used in any instruction where an immediate operand is allowed.</p>
<h3 id="22-cluster-of-cooperative-thread-arraysæœ‰blockå°±æœ‰block-clusteræœ‰ctaå°±æœ‰cta-cluster">2.2 Cluster of Cooperative Thread Arrays<sup>(æœ‰blockå°±æœ‰block clusterï¼Œæœ‰CTAå°±æœ‰CTA cluster)</sup>
</h3><p>Cluster is a group of CTAs that run concurrently or in parallel and can synchronize and communicate with each other via shared memory. The executing CTA has to make sure that the shared memory of the peer CTA exists before communicating with it via shared memory and the peer CTA hasnâ€™t exited before completing the shared memory operation.</p>
<p>Threads within the different CTAs in a cluster can synchronize and communicate with each other via shared memory. Cluster-wide barriers can be used to synchronize all the threads within the cluster. Each CTA in a cluster has a unique CTA identifier within its cluster  <em><em>(<strong>â€‹</strong></em>cluster_ctaid</em><strong>â€‹ <strong>)</strong> . Each cluster of CTAs has 1D, 2D or 3D shape specified by the parameter <em>cluster_nctaid</em>. Each CTA in the cluster also has a unique CTA identifier  <em><em>(<strong>â€‹</strong></em>cluster_ctarank</em></strong>â€‹ <strong>)</strong>  across all dimensions. The total number of CTAs across all the dimensions in the cluster is specified by <em><strong>cluster_nctarank</strong></em>. Threads may read and use these values through <u>predefined, read-only special registers </u>â€‹<u>â€‹<code>%cluster_ctaid</code>â€‹</u>â€‹<u>, </u>â€‹<u>â€‹<code>%cluster_nctaid</code>â€‹</u>â€‹<u>, </u>â€‹<u>â€‹<code>%cluster_ctarank</code>â€‹</u>â€‹<u>, </u>â€‹<u>â€‹<code>%cluster_nctarank</code>â€‹</u>â€‹.</p>
<p>Cluster level is applicable only on target architecture <code>sm_90</code>â€‹ or higher. Specifying cluster level during launch time is optional. If the user specifies the cluster dimensions at launch time then it will be treated as explicit cluster launch, otherwise it will be treated as implicit cluster launch with default dimension 1x1x1. PTX provides read-only special register <code>%is_explicit_cluster</code>â€‹ to differentiate between explicit and implicit cluster launch.</p>
<h3 id="23-grid-of-clustersæœ‰blockå°±æœ‰gridä»–è¿™é‡Œå†™çš„æ˜¯grid-of-clusters">2.3 Grid of Clusters<sup>(æœ‰blockå°±æœ‰gridï¼Œä»–è¿™é‡Œå†™çš„æ˜¯grid of clusters)</sup>
</h3><p>There is a maximum number of threads that a CTA can contain and a maximum number of CTAs that a cluster can contain. However, clusters with CTAs that execute the same kernel can be batched together into a grid of clusters, so that the total number of threads that can be launched in a single kernel invocation is very large. <sup>(å¤„ç†ç›¸åŒå†…æ ¸çš„CTAå¯ä»¥æ‰¹å¤„ç†åˆ°ä¸€èµ·ï¼Œå½¢æˆä¸€ä¸ªé›†ç¾¤ç½‘ç»œï¼Œä»è€Œä½¿å¾—å•æ¬¡å†…æ ¸è°ƒç”¨ä¸­å¯å¯åŠ¨çš„æ€»çº¿ç¨‹æ•°éå¸¸å¤§)</sup>â€‹This comes at the expense of reduced thread communication and synchronization, because threads in different clusters cannot communicate and synchronize with each other.<sup>(åªæœ‰é›†ç¾¤å†…éƒ¨çš„çº¿ç¨‹æ‰æ˜¯å¯ä»¥é€šä¿¡å’ŒåŒæ­¥çš„ï¼Œé›†ç¾¤ä¹‹é—´æ— æ³•åšåˆ°ï¼Œæ‰€ä»¥é›†ç¾¤ç½‘ç»œå½¢æˆçš„æ¡ä»¶æ˜¯ä»¥å‡å°‘çº¿ç¨‹é—´é€šä¿¡å’ŒåŒæ­¥ä¸ºä»£ä»·çš„)</sup></p>
<p>Each cluster has a unique cluster identifier (<em><strong>clusterid</strong></em>) within a grid of clusters. Each grid of clusters has a 1D, 2D , or 3D shape specified by the parameter <em><strong>nclusterid</strong></em>. Each grid also has a unique temporal grid identifier (<em><strong>gridid</strong></em>). Threads may read and use these values through <u>predefined, read-only special registers </u>â€‹<u>â€‹<code>%tid</code>â€‹</u>â€‹<u>, </u>â€‹<u>â€‹<code>%ntid</code>â€‹</u>â€‹<u>, </u>â€‹<u>â€‹<code>%clusterid</code>â€‹</u>â€‹<u>, </u>â€‹<u>â€‹<code>%nclusterid</code>â€‹</u>â€‹<u>, and </u>â€‹<u>â€‹<code>%gridid</code>â€‹</u>â€‹.</p>
<p>Each CTA has a unique identifier (<em><strong>ctaid</strong></em>) within a grid. Each grid of CTAs has 1D, 2D, or 3D shape specified by the parameter <em><strong>nctaid</strong></em>. Thread may use and read these values through <u>predefined, read-only special registers </u>â€‹<u>â€‹<code>%ctaid</code>â€‹</u>â€‹<u> and </u>â€‹<u>â€‹<code>%nctaid</code>â€‹</u>â€‹.</p>
<p>Each kernel is executed as a batch of threads organized as a grid of clusters consisting of CTAs where cluster is optional level and is applicable only for target architectures <code>sm_90</code>â€‹ and higher. <a class="link" href="https://docs.nvidia.com/cuda/parallel-thread-execution/index.html#grid-of-clusters-grid-with-ctas"  target="_blank" rel="noopener"
    >Figure 1</a> shows a grid consisting of CTAs and <a class="link" href="https://docs.nvidia.com/cuda/parallel-thread-execution/index.html#grid-of-clusters-grid-with-clusters"  target="_blank" rel="noopener"
    >Figure 2</a> shows a grid consisting of clusters.</p>
<p>Grids may be launched with dependencies between one another - a grid may be a dependent grid and/or a prerequisite grid. To understand how grid dependencies may be defined, refer to the section on â€‹<em>CUDA Graphs</em>â€‹ in the â€‹*Cuda Programming Guide<sup>(è¿™æ ·ä¸€çœ‹ï¼Œä¼¼ä¹å¯ä»¥èµ·ä¸æ­¢ä¸€ä¸ªgrid)</sup>*â€‹.<sup>(è¿™æ ·ä¸€çœ‹ï¼Œä¼¼ä¹å¯ä»¥èµ·ä¸æ­¢ä¸€ä¸ªgrid)</sup></p>
<h2 id="3-memory-hierarchyç´¯äº†æ˜å¤©å†çœ‹è¿™ä¸ª">3. Memory Hierarchy<sup>(ç´¯äº†ï¼Œæ˜å¤©å†çœ‹è¿™ä¸ª)</sup>
</h2><p>PTX threads may access data from multiple state spaces during their execution as illustrated by <a class="link" href="https://docs.nvidia.com/cuda/parallel-thread-execution/index.html#memory-hierarchy-memory-hierarchy-with-clusters"  target="_blank" rel="noopener"
    >Figure 3</a> where cluster level is introduced from target architecture <code>sm_90</code>â€‹ onwards. Each thread has a private local memory. Each thread block (CTA) has a shared memory visible to all threads of the block and to all active blocks in the cluster and with the same lifetime as the block. Finally, all threads have access to the same global memory.</p>
<p>There are additional state spaces accessible by all threads: the constant, param, texture, and surface state spaces. Constant and texture memory are read-only; surface memory is readable and writable. The global, constant, param, texture, and surface state spaces are optimized for different memory usages. For example, texture memory offers different addressing modes as well as data filtering for specific data formats. Note that texture and surface memory is cached, and within the same kernel call, the cache is not kept coherent with respect to global memory writes and surface memory writes, so any texture fetch or surface read to an address that has been written to via a global or a surface write in the same kernel call returns undefined data. In other words, a thread can safely read some texture or surface memory location only if this memory location has been updated by a previous kernel call or memory copy, but not if it has been previously updated by the same thread or another thread from the same kernel call.</p>
<p>The global, constant, and texture state spaces are persistent across kernel launches by the same application.</p>
<p>Both the host and the device maintain their own local memory, referred to as <em>host memory</em> and <em>device memory</em>, respectively. The device memory may be mapped and read or written by the host, or, for more efficient transfer, copied from the host memory through optimized API calls that utilize the deviceâ€™s high-performance <em>Direct Memory Access (DMA)</em>  engine.</p>
<hr>
<h1 id="ptx-syntax"><span data-type="text" style="background-color: var(--b3-font-background4);">PTX Syntax</span>
</h1><p>PTX programs are a collection of text source modules (files). PTX source modules have an   <strong><u></u></strong>   <strong><u>assembly-language style<sup>(æ±‡ç¼–é£æ ¼ )</sup></strong></u> syntax with instruction <em><strong>operation codes</strong></em> and <em><strong>operands</strong></em>. Pseudo-operations specify symbol and addressing management. <strong>The ptxas optimizing backend compiler<sup>(ptxasåç«¯ä¼˜åŒ–ç¼–è¯‘å™¨ï¼Œæ•´ä½“æ˜¯ä¸€ä¸ªåè¯ï¼Œè¿™ä¸ªç¼–è¯‘å™¨ä¼˜åŒ–å¹¶æ±‡ç¼–äº†PTXæºæ¨¡å—æ¥ç”Ÿæˆå¯¹åº”çš„äºŒè¿›åˆ¶å¯¹è±¡æ–‡ä»¶ï¼ˆæˆ‘ä¼°è®¡å°±æ˜¯sassï¼‰)</sup></strong> optimizes and assembles PTX source modules to produce corresponding binary object files.</p>
<h2 id="1source-format">1.Source Format
</h2><p>Source modules are ASCII text. Lines are separated by the newline character <sup>(æ¢è¡Œç¬¦ )</sup>(<code>\n</code>â€‹).</p>
<p>All whitespace characters are equivalent; whitespace is ignored except for its use in separating tokens in the language.<sup>(æ‰€æœ‰ç©ºç™½ç¬¦æ˜¯ç­‰æ•ˆçš„ï¼Œç©ºç™½ç¬¦åªåœ¨åˆ†éš”è¯­è¨€ä¸­çš„æ ‡è®°æ—¶èµ·ä½œç”¨ã€‚)</sup></p>
<p>The C preprocessor cpp<sup>(è¿™é‡Œçš„cppåº”è¯¥æŒ‡çš„æ˜¯C preprocessorï¼Œppæ˜¯æ¥è‡ªäºpreprocessor)</sup> may be used to process PTX source modules. Lines beginning with <code>#</code>â€‹ are preprocessor directives<sup>(directiveså¥½åƒæ˜¯æŒ‡ä»¤çš„æ„æ€ï¼Œåœ¨ptxé‡Œé¢ä¼¼ä¹ç‰¹æŒ‡é‚£äº›é¢„å¤„ç†æŒ‡ä»¤ï¼Œåœ¨4.3é‡Œé¢æœ‰æåˆ°directive or instructionï¼Œè¯´æ˜è¿™ä¿©æ˜¯æœ‰åŒºåˆ†çš„ï¼Œåœ¨4.3åœ¨ç»†è¯´åŒºåˆ†)</sup>. The following are common preprocessor directives:</p>
<p>â€‹<code>#include</code>â€‹, <code>#define</code>â€‹, <code>#if</code>â€‹, <code>#ifdef</code>â€‹, <code>#else</code>â€‹, <code>#endif</code>â€‹, <code>#line</code>â€‹, <code>#file</code>â€‹</p>
<p><em>C: A Reference Manual</em> by Harbison and Steele provides a good description of the C preprocessor.</p>
<p>PTX is case sensitive and uses lowercase for keywords.<sup>(ptxå¤§å°å†™æ•æ„Ÿï¼Œå…³é”®å­—éƒ½æ˜¯å°å†™)</sup></p>
<p>Each PTX module must begin with a â€‹.versionâ€‹ directive specifying the PTX language version, followed by a â€‹.targetâ€‹ directive specifying the target architecture assumed.<sup>(æ¯ä¸ªptxæ¨¡å—éƒ½æ˜¯ç”±.versionå¼€å¤´ï¼ŒæŒ‡å®šptxç‰ˆæœ¬ï¼Œåé¢è·Ÿä¸€ä¸ª.targetæŒ‡æ˜ç›®æ ‡æ¶æ„)</sup> See <a class="link" href="https://docs.nvidia.com/cuda/parallel-thread-execution/index.html#ptx-module-directives"  target="_blank" rel="noopener"
    >PTX Module Directives</a> for a more information on these directives.</p>
<h2 id="2commentsptxçš„æ³¨é‡Šè§„åˆ™å’ŒccppåŸºæœ¬ä¸Šæ˜¯ä¸€æ ·çš„ä¸ä¸€æ ·çš„ç‚¹å‹¾ç”»å‡ºæ¥äº†">2.Comments<sup>(ptxçš„æ³¨é‡Šè§„åˆ™ï¼Œå’ŒC/CPPåŸºæœ¬ä¸Šæ˜¯ä¸€æ ·çš„ï¼Œä¸ä¸€æ ·çš„ç‚¹å‹¾ç”»å‡ºæ¥äº†)</sup>
</h2><p>Comments in PTX follow C/C++ syntax, using non-nested <code>/*</code>â€‹ and <code>*/</code>â€‹ for comments that may span multiple lines, and using <code>//</code>â€‹ to begin a comment that extends up to the next newline character, which terminates the current line.  <u><strong>Comments cannot occur within character constants, string literals, or within other comments.</strong></u></p>
<p>Comments in PTX are treated as whitespace.</p>
<h2 id="3statementsè¯­å¥">3.Statements<sup>(è¯­å¥)</sup>
</h2><p>A PTX statement is either a directive or an instruction.<sup>(è¿™é‡Œå¯¹directiveå’Œinstructionåšäº†ä¸€ä¸ªåŒºåˆ† 1. Directiveï¼ˆæŒ‡ä»¤ï¼‰ å®šä¹‰ï¼šDirective æ˜¯ PTX ä»£ç ä¸­çš„é¢„å¤„ç†æŒ‡ä»¤ï¼Œå®ƒå‘Šè¯‰ç¼–è¯‘å™¨å¦‚ä½•å¤„ç†ä»£ç ï¼Œæˆ–è€…å®šä¹‰ä¸€äº›ç¼–è¯‘æ—¶çš„è®¾ç½®ã€‚Directive æœ¬èº«ä¸æ‰§è¡Œä»»ä½•è®¡ç®—ï¼Œå®ƒä»¬é€šå¸¸ç”¨äºè®¾å®šæ•°æ®ã€å¯„å­˜å™¨ç­‰çš„å±æ€§ï¼Œæˆ–è€…æ§åˆ¶ä»£ç ç”Ÿæˆçš„è¿‡ç¨‹ã€‚ ä½œç”¨ï¼šå®ƒä»¬é€šå¸¸ç”¨äºå®šä¹‰å˜é‡ã€æ³¨å†Œä¿¡æ¯ã€å†…å­˜ç©ºé—´ç­‰è®¾ç½®ã€‚ä¾‹å¦‚ï¼Œå®šä¹‰å¯„å­˜å™¨ã€å…¨å±€å†…å­˜ã€å…±äº«å†…å­˜ç­‰ã€‚ å¸¸è§çš„ PTX directive ç¤ºä¾‹ï¼š .regï¼šç”¨äºå®šä¹‰å¯„å­˜å™¨ã€‚ .globalï¼šç”¨äºå®šä¹‰å…¨å±€å†…å­˜ã€‚ .sharedï¼šç”¨äºå®šä¹‰å…±äº«å†…å­˜ã€‚ .constï¼šç”¨äºå®šä¹‰å¸¸é‡å†…å­˜ã€‚ ç¤ºä¾‹ï¼š  .reg .b32 r1, r2;  // å®šä¹‰32ä½çš„å¯„å­˜å™¨r1å’Œr2 .global .f32 array[N];  // å®šä¹‰ä¸€ä¸ªåä¸ºarrayçš„å…¨å±€æµ®ç‚¹æ•°ç»„  2. Instructionï¼ˆæŒ‡ä»¤ï¼‰ å®šä¹‰ï¼šInstruction æ˜¯ PTX ä¸­çš„è®¡ç®—æˆ–æ“ä½œæŒ‡ä»¤ï¼Œå®ƒæ‰§è¡Œå…·ä½“çš„æ“ä½œæˆ–è®¡ç®—ä»»åŠ¡ã€‚æŒ‡ä»¤æ˜¯ç¨‹åºå®é™…æ‰§è¡Œçš„ä»£ç ï¼Œæ¶‰åŠç®—æœ¯è¿ç®—ã€å†…å­˜è®¿é—®ã€æ§åˆ¶æµç­‰ã€‚ ä½œç”¨ï¼šå®ƒä»¬æ‰§è¡Œå„ç§ç±»å‹çš„æ“ä½œï¼Œå¦‚åŠ è½½/å­˜å‚¨ã€ç®—æœ¯è®¡ç®—ã€æ§åˆ¶æµæŒ‡ä»¤ï¼ˆè·³è½¬ã€æ¡ä»¶åˆ¤æ–­ï¼‰ç­‰ã€‚ å¸¸è§çš„ PTX instruction ç¤ºä¾‹ï¼š movï¼šç§»åŠ¨æ•°æ®ã€‚ addï¼šåŠ æ³•è¿ç®—ã€‚ ld.globalï¼šå…¨å±€å†…å­˜åŠ è½½ã€‚ shlï¼šæŒ‰ä½å·¦ç§»ã€‚ ç¤ºä¾‹ï¼š  mov.b32 r1, %tid.x;  // å°†çº¿ç¨‹IDçš„xéƒ¨åˆ†å­˜å…¥å¯„å­˜å™¨r1 add.f32 r2, r2, 0.5; // å°†å¯„å­˜å™¨r2çš„å€¼åŠ ä¸Š0.5 shl.b32 r1, r1, 2;   // å°†å¯„å­˜å™¨r1çš„å€¼å·¦ç§»2ä½  ä¸»è¦åŒºåˆ«ï¼š Directive æ˜¯ç¼–è¯‘æ—¶çš„æŒ‡ä»¤ï¼Œä¸»è¦ç”¨äºè®¾ç½®æˆ–å£°æ˜å˜é‡ã€å¯„å­˜å™¨ã€å†…å­˜ç­‰ï¼Œå®ƒä»¬å¹¶ä¸æ‰§è¡Œå®é™…çš„è®¡ç®—ã€‚ Instruction æ˜¯æ‰§è¡Œæ—¶çš„æŒ‡ä»¤ï¼Œå®ƒä»¬æ‰§è¡Œå…·ä½“çš„è®¡ç®—ä»»åŠ¡æˆ–å†…å­˜æ“ä½œï¼Œæ˜¯ç¨‹åºæ‰§è¡Œçš„æ ¸å¿ƒéƒ¨åˆ†ã€‚ æ€»ç»“æ¥è¯´ï¼Œdirective ä¸»è¦è´Ÿè´£ä»£ç çš„é…ç½®å’Œå£°æ˜ï¼Œè€Œ instruction åˆ™æ˜¯å®é™…çš„æ“ä½œæŒ‡ä»¤ï¼Œæ§åˆ¶ç¨‹åºçš„è®¡ç®—è¿‡ç¨‹ã€‚)</sup> Statements begin with an optional label<sup>(ä»¥å¯é€‰çš„æ ‡ç­¾å¼€å¤´)</sup> and end with a semicolon.<sup>(ä»¥åˆ†å·ç»“å°¾ )</sup></p>
<p><strong>Examples</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">        .reg     .b32 r1, r2;
</span></span><span class="line"><span class="cl">        .global  .f32  array[N];
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">start:  mov.b32   r1, %tid.x;
</span></span><span class="line"><span class="cl">        shl.b32   r1, r1, 2;          // shift thread id by 2 bits
</span></span><span class="line"><span class="cl">        ld.global.b32 r2, array[r1];  // thread[tid] gets array[tid]
</span></span><span class="line"><span class="cl">        add.f32   r2, r2, 0.5;        // add 1/2
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="31-directive-statements">3.1 Directive Statements
</h3><p>Directive keywords begin with a dot, so no conflict is possible with user-defined identifiers. The directives in PTX are listed in <a class="link" href="https://docs.nvidia.com/cuda/parallel-thread-execution/index.html#directive-statements-ptx-directives"  target="_blank" rel="noopener"
    >Table 1</a> and described in <a class="link" href="https://docs.nvidia.com/cuda/parallel-thread-execution/index.html#state-spaces-types-and-variables"  target="_blank" rel="noopener"
    >State Spaces, Types, and Variables</a> and <a class="link" href="https://docs.nvidia.com/cuda/parallel-thread-execution/index.html#directives"  target="_blank" rel="noopener"
    >Directives</a>.</p>
<p>â€‹<img src="http://127.0.0.1:3622/assets/image-20250217211249-rpbipdu.png"
	
	
	
	loading="lazy"
	
		alt="image"
	
	
>â€‹</p>
<h3 id="32-instruction-statementsæ“ä½œç æ“ä½œæ•°æ“ä½œæ•°ä»¥é€—å·åˆ†éš”ä»¥åˆ†å·ç»“æŸ">3.2 Instruction Statements<sup>(æ“ä½œç +æ“ä½œæ•°ï¼ˆæ“ä½œæ•°ä»¥é€—å·åˆ†éš”ï¼Œä»¥åˆ†å·ç»“æŸï¼‰)</sup>
</h3><p>Instructions are formed from an instruction opcode followed by a comma-separated<sup>(ä»¥é€—å·åˆ†éš”)</sup> list of zero or more operands, and terminated with a semicolon<sup>(ä»¥åˆ†å·ç»“å°¾)</sup>. Operands may be register variables, constant expressions, address expressions, or label names. Instructions have an optional guard predicate which controls conditional execution. The guard predicate follows the optional label and precedes the opcode, and is written as <code>@p</code>â€‹, where <code>p</code>â€‹ is a predicate register. The guard predicate may be optionally negated, written as <code>@!p</code>â€‹.</p>
<p>The destination operand is first, followed by source operands.</p>
<p>Instruction keywords are listed in <a class="link" href="https://docs.nvidia.com/cuda/parallel-thread-execution/index.html#instruction-statements-reserved-instruction-keywords-new"  target="_blank" rel="noopener"
    >Table 2</a>. All instruction keywords are reserved tokens in PTX<sup>(å¤ªé•¿äº†ï¼Œæˆ‘æ²¡æˆªä¸‹æ¥ï¼Œctrlç‚¹Table2å°±å¯ä»¥çœ‹åˆ°äº†)</sup>.</p>
<h2 id="4identifiersæ ‡è¯†ç¬¦">4.Identifiers<sup>(æ ‡è¯†ç¬¦)</sup>
</h2><p>User-defined identifiers follow extended C++ rules: they either start with a letter followed by zero or more letters, digits, underscore, or dollar characters; or they start with an underscore, dollar, or percentage character followed by one or more letters, digits, underscore, or dollar characters:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">followsym:   [a-zA-Z0-9_$]
</span></span><span class="line"><span class="cl">identifier:  [a-zA-Z]{followsym}* | {[_$%]{followsym}+
</span></span></code></pre></td></tr></table>
</div>
</div><p>PTX does not specify a maximum length for identifiers and suggests that all implementations support a minimum length of at least 1024 characters.</p>
<p>Many high-level languages such as C and C++ follow similar rules for identifier names, except that the percentage sign is not allowed. PTX allows the percentage sign as the first character of an identifier. The percentage sign can be used to avoid name conflicts, e.g., between user-defined variable names and compiler-generated names.</p>
<p>PTX predefines one constant and a small number of special registers that begin with the percentage sign<sup>(PTXä»¥ç™¾åˆ†å·å¼€å¤´é¢„å®šä¹‰äº†ä¸€äº›ç‰¹æ®Šå¯„å­˜å™¨)</sup>, listed in <a class="link" href="https://docs.nvidia.com/cuda/parallel-thread-execution/index.html#identifiers-predefined-identifiers"  target="_blank" rel="noopener"
    >Table 3</a>.</p>
<p>â€‹<img src="http://127.0.0.1:3622/assets/image-20250218100058-0hk4byx.png"
	
	
	
	loading="lazy"
	
		alt="image"
	
	
>â€‹</p>
<h2 id="5constants">5.Constants
</h2><p>PTX supports integer and floating-point constants and constant expressions. These constants may be used in data initialization and as operands to instructions. Type checking rules remain the same for integer, floating-point, and bit-size types. For predicate-type data and instructions, integer constants are allowed and are interpreted as in C, i.e., zero values are <code>False</code>â€‹ and non-zero values are <code>True</code>â€‹.</p>
<h3 id="51-integer-constants">5.1 Integer Constants
</h3><p>Integer constants are 64-bits in size and are either signed or unsigned, i.e., every integer constant has type <code>.s64</code>â€‹ or <code>.u64</code>â€‹. The signed/unsigned nature of an integer constant is needed to correctly evaluate constant expressions containing operations such as division and ordered comparisons, where the behavior of the operation depends on the operand types. When used in an instruction or data initialization, each integer constant is converted to the appropriate size based on the data or instruction type at its use.</p>
<p>Integer literals may be written in decimal, hexadecimal, octal, or binary<sup>(åè¿›åˆ¶ã€åå…­è¿›åˆ¶ã€å…«è¿›åˆ¶æˆ–äºŒè¿›åˆ¶)</sup> notation. The syntax follows that of C. Integer literals may be followed immediately by the letter <code>U</code>â€‹ to indicate that the literal is unsigned.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">hexadecimal literal:  0[xX]{hexdigit}+U?
</span></span><span class="line"><span class="cl">octal literal:        0{octal digit}+U?
</span></span><span class="line"><span class="cl">binary literal:       0[bB]{bit}+U?
</span></span><span class="line"><span class="cl">decimal literal       {nonzero-digit}{digit}*U?
</span></span></code></pre></td></tr></table>
</div>
</div><p>Integer literals are non-negative and have a type determined by their magnitude and optional type suffix as follows: literals are signed (<code>.s64</code>â€‹) unless the value cannot be fully represented in <code>.s64</code>â€‹ or the unsigned suffix is specified, in which case the literal is unsigned (<code>.u64</code>â€‹).</p>
<p>The predefined integer constant <code>WARP_SZ</code>â€‹ specifies the number of threads per warp for the target platform; to date, all target architectures have a <code>WARP_SZ</code>â€‹ value of 32.</p>
<h3 id="52-floating-point-constants">5.2 Floating-Point Constants
</h3><p>Floating-point constants are represented as 64-bit double-precision values, and all floating-point constant expressions are evaluated using 64-bit double precision arithmetic. The only exception is the 32-bit hex notation for expressing an exact single-precision floating-point value; such values retain their exact 32-bit single-precision value and may not be used in constant expressions. Each 64-bit floating-point constant is converted to the appropriate floating-point size based on the data or instruction type at its use.</p>
<p>Floating-point literals may be written with an optional decimal point and an optional signed exponent. Unlike C and C++, there is no suffix letter to specify size; literals are always represented in 64-bit double-precision format.</p>
<p>PTX includes a second representation of floating-point constants for specifying the exact machine representation using a hexadecimal constant. To specify IEEE 754 double-precision floating point values, the constant begins with <sup>(åŒç²¾åº¦æµ®ç‚¹æ•° æ˜¯0dæˆ–è€…0Då¼€å¤´ï¼Œåé¢è·Ÿ16ä¸ª16è¿›åˆ¶ å•ç²¾åº¦æµ®ç‚¹æ•° æ˜¯0fæˆ–è€…0Få¼€å¤´ï¼Œåé¢è·Ÿ8ä¸ª16è¿›åˆ¶)</sup>â€‹0dâ€‹ or â€‹0Dâ€‹ followed by 16 hex digits. To specify IEEE 754 single-precision floating point values, the constant begins with â€‹0fâ€‹ or â€‹0F<sup>(åŒç²¾åº¦æµ®ç‚¹æ•° æ˜¯0dæˆ–è€…0Då¼€å¤´ï¼Œåé¢è·Ÿ16ä¸ª16è¿›åˆ¶ å•ç²¾åº¦æµ®ç‚¹æ•° æ˜¯0fæˆ–è€…0Få¼€å¤´ï¼Œåé¢è·Ÿ8ä¸ª8è¿›åˆ¶)</sup>â€‹ followed by 8 hex digits.<sup>(åŒç²¾åº¦æµ®ç‚¹æ•° æ˜¯0dæˆ–è€…0Då¼€å¤´ï¼Œåé¢è·Ÿ16ä¸ª16è¿›åˆ¶ å•ç²¾åº¦æµ®ç‚¹æ•° æ˜¯0fæˆ–è€…0Få¼€å¤´ï¼Œåé¢è·Ÿ8ä¸ª8è¿›åˆ¶)</sup></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">0[fF]{hexdigit}{8}      // single-precision floating point
</span></span><span class="line"><span class="cl">0[dD]{hexdigit}{16}     // double-precision floating point
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Example</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">mov.f32  $f3, 0F3f800000;       //  1.0
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="53-predicate-è°“è¯æœ‰ç‚¹é™Œç”Ÿçš„è¯æ±‡-è°“è¯predicateæ˜¯ä¸€ä¸ªé€»è¾‘æˆ–æ¡ä»¶åˆ¤æ–­çš„æœ¯è¯­é€šå¸¸è¡¨ç¤ºä¸€ç§åˆ¤æ–­å¼æˆ–æ¡ä»¶ç”¨äºåˆ¤æ–­æŸä¸ªç‰¹å®šçš„æ¡ä»¶æ˜¯å¦æˆç«‹åœ¨ç¼–ç¨‹è¯­è¨€ä¸­è°“è¯é€šå¸¸æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼å…¶å€¼ä¸ºçœŸæˆ–å‡true-æˆ–-false-åœ¨-ptx-è¿™æ ·çš„æ±‡ç¼–è¯­è¨€ä¸­è°“è¯å¸¸å¸¸ç”¨äºæ§åˆ¶ç¨‹åºçš„æ‰§è¡Œæµç¨‹ä¾‹å¦‚åœ¨æŸäº›æŒ‡ä»¤çš„æ‰§è¡Œä¸Šè¿›è¡Œæ¡ä»¶åˆ¤æ–­--å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç®€å•çš„æ¡ä»¶è¯­å¥-if-x--5-------æ‰§è¡ŒæŸäº›æ“ä½œ--åœ¨è¿™é‡Œx--5-å°±æ˜¯ä¸€ä¸ªè°“è¯å®ƒçš„å€¼æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼true-æˆ–-falseå¦‚æœ-x-çš„å€¼å¤§äº-5è°“è¯-x--5-ä¸º-trueé‚£ä¹ˆå°±ä¼šæ‰§è¡Œåé¢çš„æ“ä½œå¦‚æœ-x-å°äºæˆ–ç­‰äº-5è°“è¯ä¸º-falseæ“ä½œå°±ä¸ä¼šæ‰§è¡Œ--åœ¨-ptx-ä¸­çš„åº”ç”¨-åœ¨-ptx-æ±‡ç¼–ä¸­æ•´æ•°å¸¸é‡å¯ä»¥ä½œä¸ºè°“è¯ä½¿ç”¨å…·ä½“æ¥è¯´0-è¢«è§†ä¸º-falseéé›¶æ•´æ•°æ¯”å¦‚-1è¢«è§†ä¸º-trueä¾‹å¦‚-setpequ32--p0-r1-0----p0-ä¸º-1-æ—¶ç›¸å½“äº-trueè¡¨ç¤º-r1-æ˜¯å¦ç­‰äº-0-åœ¨è¿™é‡Œsetpequ32-æŒ‡ä»¤æ¯”è¾ƒå¯„å­˜å™¨-r1-å’Œ-0-æ˜¯å¦ç›¸ç­‰å¦‚æœç›¸ç­‰p0-è¢«è®¾ç½®ä¸º-1trueå¦åˆ™-p0-è¢«è®¾ç½®ä¸º-0falsep0-å°±æ˜¯ä¸€ä¸ªè°“è¯ç”¨æ¥è¡¨ç¤ºæ¡ä»¶æ˜¯å¦æˆç«‹constants">5.3 Predicate <sup>(è°“è¯ï¼Œæœ‰ç‚¹é™Œç”Ÿçš„è¯æ±‡ã€‚ è°“è¯ï¼ˆPredicateï¼‰æ˜¯ä¸€ä¸ªé€»è¾‘æˆ–æ¡ä»¶åˆ¤æ–­çš„æœ¯è¯­ï¼Œé€šå¸¸è¡¨ç¤ºä¸€ç§â€œåˆ¤æ–­å¼â€æˆ–â€œæ¡ä»¶â€ï¼Œç”¨äºåˆ¤æ–­æŸä¸ªç‰¹å®šçš„æ¡ä»¶æ˜¯å¦æˆç«‹ã€‚åœ¨ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œè°“è¯é€šå¸¸æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œå…¶å€¼ä¸ºçœŸæˆ–å‡ï¼ˆTrue æˆ– Falseï¼‰ã€‚ åœ¨ PTX è¿™æ ·çš„æ±‡ç¼–è¯­è¨€ä¸­ï¼Œè°“è¯å¸¸å¸¸ç”¨äºæ§åˆ¶ç¨‹åºçš„æ‰§è¡Œæµç¨‹ï¼Œä¾‹å¦‚åœ¨æŸäº›æŒ‡ä»¤çš„æ‰§è¡Œä¸Šè¿›è¡Œæ¡ä»¶åˆ¤æ–­ã€‚  å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç®€å•çš„æ¡ä»¶è¯­å¥ï¼š if (x &gt; 5) {     // æ‰§è¡ŒæŸäº›æ“ä½œ } åœ¨è¿™é‡Œï¼Œx &gt; 5 å°±æ˜¯ä¸€ä¸ªè°“è¯ï¼Œå®ƒçš„å€¼æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼ˆTrue æˆ– Falseï¼‰ã€‚å¦‚æœ x çš„å€¼å¤§äº 5ï¼Œè°“è¯ x &gt; 5 ä¸º Trueï¼Œé‚£ä¹ˆå°±ä¼šæ‰§è¡Œåé¢çš„æ“ä½œï¼›å¦‚æœ x å°äºæˆ–ç­‰äº 5ï¼Œè°“è¯ä¸º Falseï¼Œæ“ä½œå°±ä¸ä¼šæ‰§è¡Œã€‚  åœ¨ PTX ä¸­çš„åº”ç”¨ï¼š åœ¨ PTX æ±‡ç¼–ä¸­ï¼Œæ•´æ•°å¸¸é‡å¯ä»¥ä½œä¸ºè°“è¯ä½¿ç”¨ã€‚å…·ä½“æ¥è¯´ï¼Œ0 è¢«è§†ä¸º Falseï¼Œéé›¶æ•´æ•°ï¼ˆæ¯”å¦‚ 1ï¼‰è¢«è§†ä¸º Trueã€‚ä¾‹å¦‚ï¼š setp.eq.u32  p0, r1, 0;   // p0 ä¸º 1 æ—¶ï¼Œç›¸å½“äº Trueï¼Œè¡¨ç¤º r1 æ˜¯å¦ç­‰äº 0 åœ¨è¿™é‡Œï¼Œsetp.eq.u32 æŒ‡ä»¤æ¯”è¾ƒå¯„å­˜å™¨ $r1 å’Œ 0 æ˜¯å¦ç›¸ç­‰ï¼Œå¦‚æœç›¸ç­‰ï¼Œp0 è¢«è®¾ç½®ä¸º 1ï¼ˆTrueï¼‰ï¼Œå¦åˆ™ p0 è¢«è®¾ç½®ä¸º 0ï¼ˆFalseï¼‰ã€‚p0 å°±æ˜¯ä¸€ä¸ªè°“è¯ï¼Œç”¨æ¥è¡¨ç¤ºæ¡ä»¶æ˜¯å¦æˆç«‹ã€‚)</sup>Constants
</h3><p>In PTX, integer constants may be used as predicates. For predicate-type data initializers and instruction operands, integer constants are interpreted as in C, i.e., zero values are <code>False</code>â€‹ and non-zero values are <code>True</code>â€‹.</p>
<h3 id="54-constant-expressions">5.4 Constant Expressions
</h3><p>In PTX, constant expressions are formed using operators as in C and are evaluated using rules similar to those in C, but simplified by restricting types and sizes, removing most casts<sup>(ç±»å‹è½¬æ¢)</sup>, and defining full semantics<sup>(å®Œæ•´çš„è¯­ä¹‰)</sup> to eliminate cases where expression evaluation in C is implementation dependent.</p>
<p>Constant expressions are formed from constant literals, unary plus and minus, basic arithmetic operators (addition, subtraction, multiplication, division), comparison operators, the conditional ternary operator ( <code>?:</code>â€‹ ), and parentheses. Integer constant expressions also allow unary logical negation (<code>!</code>â€‹), bitwise complement (<code>~</code>â€‹), remainder (<code>%</code>â€‹), shift operators (<code>&lt;&lt;</code>â€‹ and <code>&gt;&gt;</code>â€‹), bit-type operators (<code>&amp;</code>â€‹, <code>|</code>â€‹, and <code>^</code>â€‹), and logical operators (<code>&amp;&amp;</code>â€‹, <code>||</code>â€‹).</p>
<p>Constant expressions in PTX do not support casts between integer and floating-point.</p>
<p>Constant expressions are evaluated using the same operator precedence<sup>(è¿ç®—ç¬¦ä¼˜å…ˆçº§)</sup> as in C. <a class="link" href="https://docs.nvidia.com/cuda/parallel-thread-execution/index.html#constant-expressions-operator-precedence"  target="_blank" rel="noopener"
    >Table 4</a> gives operator precedence and associativity. Operator precedence is highest for unary operators<sup>(ä¸€å…ƒè¿ç®—ç¬¦æ˜¯æœ€é«˜çš„ä¼˜å…ˆçº§)</sup> and decreases with each line in the chart. Operators on the same line have the same precedence and are evaluated right-to-left for unary operators and left-to-right for binary operators.<sup>(å¯¹äºä¸€å…ƒè¿ç®—ç¬¦æ±‚å€¼é¡ºåºæ˜¯ä»å³åˆ°å·¦ å¯¹äºäºŒå…ƒè¿ç®—ç¬¦æ±‚å€¼é¡ºåºæ˜¯ä»å·¦åˆ°å³)</sup></p>
<p>â€‹<img src="http://127.0.0.1:3622/assets/image-20250218112505-ba3ao6d.png"
	
	
	
	loading="lazy"
	
		alt="image"
	
	
>â€‹</p>
<h3 id="55-integer-constant-expression-evaluation">5.5 Integer Constant Expression Evaluation
</h3><p>Integer constant expressions are evaluated at compile time according to a set of rules that determine the type (signed <code>.s64</code>â€‹ versus unsigned <code>.u64</code>â€‹) of each sub-expression. These rules are based on the rules in C, but theyâ€™ve been simplified to apply only to 64-bit integers, and behavior is fully defined in all cases (specifically, for remainder and shift operators).</p>
<ul>
<li>
<p>Literals are signed unless unsigned is needed to prevent overflow, or unless the literal uses a <code>U</code>â€‹ suffix. For example:</p>
<ul>
<li>â€‹<code>42</code>â€‹, <code>0x1234</code>â€‹, <code>0123</code>â€‹ are signed.</li>
<li>â€‹<code>0xfabc123400000000</code>â€‹, <code>42U</code>â€‹, <code>0x1234U</code>â€‹ are unsigned.</li>
</ul>
</li>
<li>
<p>Unary plus and minus preserve the type of the input operand. For example:</p>
<ul>
<li>â€‹<code>+123</code>â€‹, <code>-1</code>â€‹, <code>-(-42)</code>â€‹ are signed.</li>
<li>â€‹<code>-1U</code>â€‹, <code>-0xfabc123400000000</code>â€‹ are unsigned.</li>
</ul>
</li>
<li>
<p>Unary logical negation (<code>!</code>â€‹) produces a signed result with value <code>0</code>â€‹ or <code>1</code>â€‹.</p>
</li>
<li>
<p>Unary bitwise complement (<code>~</code>â€‹) interprets the source operand as unsigned and produces an unsigned result.</p>
</li>
<li>
<p>Some binary operators require normalization of source operands. This normalization is known as <em>the usual arithmetic conversions</em> and simply converts both operands to unsigned type if either operand is unsigned.</p>
</li>
<li>
<p>Addition, subtraction, multiplication, and division perform the usual arithmetic conversions and produce a result with the same type as the converted operands. That is, the operands and result are unsigned if either source operand is unsigned, and is otherwise signed.</p>
</li>
<li>
<p>Remainder (<code>%</code>â€‹) interprets the operands as unsigned. Note that this differs from C, which allows a negative divisor but defines the behavior to be implementation dependent.</p>
</li>
<li>
<p>Left and right shift interpret the second operand as unsigned and produce a result with the same type as the first operand. Note that the behavior of right-shift is determined by the type of the first operand: right shift of a signed value is arithmetic and preserves the sign, and right shift of an unsigned value is logical and shifts in a zero bit.</p>
</li>
<li>
<p>AND (<code>&amp;</code>â€‹), OR (<code>|</code>â€‹), and XOR (<code>^</code>â€‹) perform the usual arithmetic conversions and produce a result with the same type as the converted operands.</p>
</li>
<li>
<p>AND_OP (<code>&amp;&amp;</code>â€‹), OR_OP (<code>||</code>â€‹), Equal (<code>==</code>â€‹), and Not_Equal (<code>!=</code>â€‹) produce a signed result. The result value is 0 or 1.</p>
</li>
<li>
<p>Ordered comparisons (<code>&lt;</code>â€‹, <code>&lt;=</code>â€‹, <code>&gt;</code>â€‹, <code>&gt;=</code>â€‹) perform the usual arithmetic conversions on source operands and produce a signed result. The result value is <code>0</code>â€‹ or <code>1</code>â€‹.</p>
</li>
<li>
<p>Casting of expressions to signed or unsigned is supported using (<code>.s64</code>â€‹) and (<code>.u64</code>â€‹) casts.</p>
</li>
<li>
<p>For the conditional operator ( <code>? :</code>â€‹ ) , the first operand must be an integer, and the second and third operands are either both integers or both floating-point. The usual arithmetic conversions are performed on the second and third operands, and the result type is the same as the converted type.</p>
</li>
</ul>
<h3 id="56-summary-of-constant-expression-evaluation-rules">5.6 Summary of Constant Expression Evaluation Rules
</h3><p><a class="link" href="https://docs.nvidia.com/cuda/parallel-thread-execution/index.html#summary-of-constant-expression-evaluation-rules-constant-expression-evaluation-rules"  target="_blank" rel="noopener"
    >Table 5</a> contains a summary <sup>(ç„¯ï¼Œæœ‰è¿™ä¸ªæ€»ç»“ä¸æ—©è¯´ï¼Œå‰é¢ç™½çœ‹é‚£ä¹ˆä¹…)</sup>of the constant expression evaluation rules.</p>
<p>â€‹<img src="http://127.0.0.1:3622/assets/image-20250218114420-gvqyw33.png"
	
	
	
	loading="lazy"
	
		alt="image"
	
	
>â€‹</p>
<p>â€</p>
<hr>
<h1 id="ptx-state-spacestypesand-variables"><span data-type="text" style="background-color: var(--b3-font-background4);">PTX State Spacesï¼ŒTypesï¼Œand Variables</span>
</h1><p>While the specific resources available in a given target GPU will vary, the kinds of resources will be common across platforms, and these resources are abstracted in PTX through â€‹**<u>state spaces**</u>â€‹ and â€‹**data types<sup>(PTXä¸­é€šè¿‡çŠ¶æ€ç©ºé—´å’Œæ•°æ®ç±»å‹æ¥æŠ½è±¡èµ„æº)</sup>**â€‹.<sup>(PTXä¸­é€šè¿‡çŠ¶æ€ç©ºé—´å’Œæ•°æ®ç±»å‹æ¥æŠ½è±¡èµ„æº)</sup></p>
<h2 id="1-state-spaces">1. State Spaces
</h2><p>A state space is a storage area with particular characteristics. All variables reside in some state space<sup>(æ‰€æœ‰çš„å˜é‡éƒ½é©»ç•™åœ¨æŸä¸€ä¸ªçŠ¶æ€ç©ºé—´é‡Œé¢)</sup>. The characteristics of a state space include its size, addressability, access speed, access rights, and level of sharing between threads.<sup>(state spaceï¼ˆçŠ¶æ€ç©ºé—´ï¼‰çš„ç‰¹æ€§)</sup></p>
<p>The state spaces defined in PTX are a byproduct of parallel programming and graphics programming. The list of state spaces is shown in <a class="link" href="https://docs.nvidia.com/cuda/parallel-thread-execution/index.html#state-spaces-state-spaces-tab"  target="_blank" rel="noopener"
    >Table 6</a>,and properties of state spaces are shown in <a class="link" href="https://docs.nvidia.com/cuda/parallel-thread-execution/index.html#state-spaces-properties-state-spaces"  target="_blank" rel="noopener"
    >Table 7</a>.</p>
<p>â€‹<img src="http://127.0.0.1:3622/assets/image-20250218115657-eprgpit.png"
	
	
	
	loading="lazy"
	
		alt="image"
	
	
>â€‹</p>
<p>â€‹<img src="http://127.0.0.1:3622/assets/image-20250218115713-s7q3swh.png"
	
	
	
	loading="lazy"
	
		alt="image"
	
	
>â€‹</p>
<h3 id="11-register-state-space">1.1 Register State Space
</h3><p>Registers (<code>.reg</code>â€‹ state space) are fast storage locations. The number of registers is limited, and will vary from platform to platform. When the limit is exceeded, register variables will be spilled to memory, causing changes in performance. For each architecture, there is a recommended maximum number of registers to use (see the <em>CUDA Programming Guide</em> for details).</p>
<p>Registers may be typed (signed integer, unsigned integer, floating point, predicate) or untyped. Register size is restricted; aside from predicate registers which are 1-bit, scalar registers have a width of 8-, 16-, 32-, 64-, or 128-bits, and vector registers have a width of 16-, 32-, 64-, or 128-bits. The most common use of 8-bit registers is with <code>ld</code>â€‹, <code>st</code>â€‹, and <code>cvt</code>â€‹ instructions, or as elements of vector tuples.</p>
<p>Registers differ from the other state spaces in that they are not fully addressable<sup>(å¯„å­˜å™¨çŠ¶æ€ç©ºé—´å’Œå…¶ä»–çŠ¶æ€ç©ºé—´çš„ä¸åŒä¹‹å¤„åœ¨äºå®ƒä»¬ä¸å¯å®Œå…¨å¯»å€)</sup>, i.e., it is not possible to refer to the address of a register<sup>(ä¸èƒ½å¼•ç”¨å¯„å­˜å™¨çš„åœ°å€)</sup>. When compiling to use the Application Binary Interface (ABI), register variables are restricted to function scope and may not be declared at module scope<sup>(å¯„å­˜å™¨å˜é‡è¢«é™åˆ¶åˆ°å‡½æ•°èŒƒå›´ä¸­ï¼Œä¸èƒ½åœ¨æ¨¡å—èŒƒå›´ä¸­å¼•ç”¨)</sup>. When compiling legacy PTX code (ISA versions prior to 3.0) containing module-scoped <code>.reg</code>â€‹ variables, the compiler silently disables use of the ABI. Registers may have alignment boundaries<sup>(è¾¹ç•Œå¯¹é½)</sup> required by multi-word loads and stores.</p>
<h3 id="12-special-register-state-spaceå­˜äº†ä¸€äº›é¢„å®šä¹‰çš„ç‰¹å®šå¹³å°çš„å¯„å­˜å™¨å¦‚ç½‘æ ¼é›†ç¾¤ctaå’Œçº¿ç¨‹å‚æ•°æ—¶é’Ÿè®¡æ•°å™¨ä»¥åŠæ€§èƒ½ç›‘æ§å¯„å­˜å™¨æ‰€æœ‰ç‰¹æ®Šå¯„å­˜å™¨éƒ½æ˜¯é¢„å®šä¹‰çš„">1.2 Special Register State Space<sup>(å­˜äº†ä¸€äº›é¢„å®šä¹‰çš„ç‰¹å®šå¹³å°çš„å¯„å­˜å™¨ï¼Œå¦‚ç½‘æ ¼ã€é›†ç¾¤ã€CTAå’Œçº¿ç¨‹å‚æ•°ã€æ—¶é’Ÿè®¡æ•°å™¨ä»¥åŠæ€§èƒ½ç›‘æ§å¯„å­˜å™¨ã€‚æ‰€æœ‰ç‰¹æ®Šå¯„å­˜å™¨éƒ½æ˜¯é¢„å®šä¹‰çš„)</sup>
</h3><p>The special register (<code>.sreg</code>â€‹) state space holds predefined, platform-specific registers, such as grid, cluster, CTA, and thread parameters, clock counters, and performance monitoring registers. All special registers are predefined.</p>
<h3 id="13-constant-state-space">1.3 Constant State Space
</h3><p>The constant (â€‹.constâ€‹) state space is a read-only memory initialized by the host<sup>(å¸¸é‡å†…ä¿ƒæ˜¯ç”±ä¸»æœºåˆå§‹åŒ–çš„å¸¸é‡å†…å­˜ï¼Œå±…ç„¶æ˜¯ä¸»æœºåˆå§‹åŒ–çš„)</sup>. Constant memory is accessed with a <code>ld.const</code>â€‹ instruction. Constant memory is restricted in size, currently limited to 64 KB<sup>(å¸¸é‡å†…å­˜çš„å¤§å°é™åˆ¶ï¼Œæœ‰64KBå›ºå®šçš„)</sup> which can be used to hold statically-sized constant variables. There is an additional 640 KB of constant memory, organized as ten independent 64 KB regions<sup>(è¿˜æœ‰é¢å¤–çš„640KBå¸¸é‡å†…å­˜ï¼Œè¢«ç»„ç»‡æˆäº†10ä¸ªç‹¬ç«‹çš„64KBåŒºåŸŸ)</sup>. The driver may allocate and initialize constant buffers in these regions and pass pointers to the buffers as kernel function parameters<sup>(ç”±é©±åŠ¨æ¥åˆ†é…å’Œåˆå§‹åŒ–è¿™äº›åŒºåŸŸä¸­çš„å¸¸é‡å†…å­˜ï¼Œå¹¶å°†æŒ‡å‘è¿™äº›ç¼“å­˜çš„æŒ‡é’ˆä½œä¸ºkernelçš„å‚æ•°ä¼ é€’)</sup>. Since the ten regions are not contiguous, the driver must ensure that constant buffers are allocated so that each buffer fits entirely within a 64 KB region and does not span a region boundary.<sup>(ç”±äºè¿™åä¸ªåŒºåŸŸä¸è¿ç»­ï¼Œé©±åŠ¨å¿…é¡»ç¡®ä¿å¸¸é‡ç¼“å†²çš„åˆ†é…æ–¹å¼ï¼Œä½¿æ¯ä¸ªç¼“å†²åŒºå®Œå…¨é€‚åˆåœ¨ä¸€ä¸ª64KBåŒºåŸŸå†…ï¼Œå¹¶ä¸”ä¸è·¨è¶ŠåŒºåŸŸè¾¹ç•Œ)</sup></p>
<p>Statically-sized constant variables have an optional variable initializer; constant variables with no explicit initializer are initialized to zero by default<sup>(æ²¡æœ‰æ˜¾å¼åˆå§‹åŒ–å™¨çš„å¸¸é‡å˜é‡é»˜è®¤ä¸ºåˆå§‹åŒ–ä¸ºé›¶)</sup>. Constant buffers allocated by the driver are initialized by the host, and pointers to such buffers are passed to the kernel as parameters. See the description of kernel parameter attributes in <a class="link" href="https://docs.nvidia.com/cuda/parallel-thread-execution/index.html#kernel-function-parameter-attributes"  target="_blank" rel="noopener"
    >Kernel Function Parameter Attributes</a> for more details on passing pointers to constant buffers as kernel parameters.</p>
<h4 id="131-banked-constant-state-spacedeprecated">1.3.1 Banked Constant State Spaceï¼ˆdeprecatedï¼‰
</h4><p>Previous versions of PTX exposed constant memory as a set of eleven 64 KB banks, with explicit bank numbers required for variable declaration and during access.</p>
<p>Prior to PTX ISA version 2.2, the constant memory was organized into fixed size banks. There were eleven 64 KB banks, and banks were specified using the <code>.const[bank]</code>â€‹ modifier, where <em>bank</em> ranged from 0 to 10. If no bank number was given, bank zero was assumed.</p>
<p>By convention, bank zero was used for all statically-sized constant variables. The remaining banks were used to declare <em>incomplete</em> constant arrays (as in C, for example), where the size is not known at compile time. For example, the declaration</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="o">.</span><span class="n">extern</span> <span class="o">.</span><span class="k">const</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">.</span><span class="n">b32</span> <span class="n">const_buffer</span><span class="p">[];</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>resulted in <code>const_buffer</code>â€‹ pointing to the start of constant bank two. This pointer could then be used to access the entire 64 KB constant bank. Multiple incomplete array variables declared in the same bank were aliased, with each pointing to the start address of the specified constant bank.</p>
<p>To access data in contant banks 1 through 10, the bank number was required in the state space of the load instruction. For example, an incomplete array in bank 2 was accessed as follows:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="o">.</span><span class="n">extern</span> <span class="o">.</span><span class="k">const</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">.</span><span class="n">b32</span> <span class="n">const_buffer</span><span class="p">[];</span>
</span></span><span class="line"><span class="cl"><span class="n">ld</span><span class="o">.</span><span class="k">const</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">b32</span>  <span class="o">%</span><span class="n">r1</span><span class="p">,</span> <span class="p">[</span><span class="n">const_buffer</span><span class="o">+</span><span class="mi">4</span><span class="p">];</span> <span class="o">//</span> <span class="nb">load</span> <span class="n">second</span> <span class="n">word</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>In PTX ISA version 2.2, we eliminated explicit banks and replaced the incomplete array representation of driver-allocated constant buffers with kernel parameter attributes that allow pointers to constant buffers to be passed as kernel parameters.</p>
<p>â€</p>
<h3 id="14-global-state-space">1.4 Global State Space
</h3><p>The global (â€‹.globalâ€‹) state space is memory that is accessible by all threads in a context.<sup>(global state spaceæ˜¯ä¸€å—æ‰€æœ‰çº¿ç¨‹éƒ½å¯ä»¥è®¿é—®çš„å†…å­˜)</sup> It is the mechanism by which threads in different CTAs, clusters, and grids can communicate<sup>(æ˜¯ä¸€ç§ä¸åŒCTAsï¼Œä¸åŒclustersï¼Œä¸åŒgridséƒ½å¯ä»¥äº¤æµçš„æœºåˆ¶)</sup>. Use <code>ld.global</code>â€‹, <code>st.global</code>â€‹, and <code>atom.global</code>â€‹ to access global variables.</p>
<p>Global variables have an optional variable initializer; global variables with no explicit initializer are initialized to zero by default.<sup>(å…¸ä¸­å…¸ä¹‹é»˜è®¤åˆå§‹åŒ–ä¸ºé›¶)</sup></p>
<h3 id="15-local-state-space">1.5 Local State Space
</h3><p>The local state space (<code>.local</code>â€‹) is private memory for each thread to keep its own data. It is typically standard memory with cache<sup>(local state spaceæ˜¯å¸¦æœ‰ç¼“å­˜çš„æ ‡å‡†å†…å­˜)</sup>. The size is limited, as it must be allocated on a per-thread basis<sup>(å¿…é¡»æŒ‰ç…§æ¯ä¸ªçº¿ç¨‹åˆ†é…)</sup>. Use <code>ld.local</code>â€‹ and <code>st.local</code>â€‹ to access local variables.</p>
<p>When compiling to use the <em>Application Binary Interface (ABI)</em> , .localâ€‹ state-space variables must be declared within function scope and are allocated on the stack<sup>(local state spaceå¿…é¡»åˆ†é…åˆ°å‡½æ•°èŒƒå›´ï¼Œå¹¶ä¸”å¿…é¡»åœ¨æ ˆä¸Šåˆ†é…å†…å­˜)</sup>. In implementations that do not support a stack, all local memory variables are stored at fixed addresses, recursive function calls are not supported, and â€‹.localâ€‹ variables may be declared at module scope<sup>(åœ¨ä¸æ”¯æŒæ ˆçš„å®ç°ä¸­ï¼Œæ‰€æœ‰çš„å±€éƒ¨å†…å­˜å˜é‡å­˜å‚¨åœ¨å›ºå®šåœ°å€ä¸­ï¼Œä¸æ”¯æŒé€’å½’å‡½æ•°è°ƒç”¨ï¼Œå¹¶ä¸”localå˜é‡å¯ä»¥åœ¨æ¨¡å—èŒƒå›´å†…å£°æ˜)</sup>. When compiling legacy PTX code (ISA versions prior to 3.0) containing module-scoped <code>.local</code>â€‹ variables, the compiler silently disables use of the ABI.</p>
<h3 id="16-parameter-state-space">1.6 Parameter State Space
</h3><p>The parameter (<code>.param</code>â€‹) state space is used (1) to pass input arguments from the host to the kernel, (2a) to declare formal input and return parameters for device functions called from within kernel execution, and (2b) to declare locally-scoped byte array variables that serve as function call arguments, typically for passing large structures by value to a function. Kernel function parameters differ from device function parameters in terms of access and sharing (read-only versus read-write, per-kernel versus per-thread)<sup>(parameterå¯¹äºkernel functionï¼ˆ<strong>global</strong>ï¼‰å’Œdevice functionï¼ˆ<strong>device</strong>ï¼‰çš„è®¿é—®ç±»å‹å’Œä½œç”¨åŸŸæ˜¯ä¸ä¸€æ ·çš„)</sup>. Note that PTX ISA versions 1.x supports only kernel function parameters in .param space<sup>(ptx 1.xç‰ˆæœ¬åªæ”¯æŒfunction parameters in .param spaceï¼ˆä¸æ”¯æŒdevice functionï¼‰)</sup>; device function parameters were previously restricted to the register state space. The use of parameter state space for device function parameters was introduced in PTX ISA version 2.0<sup>(parameter for device function åœ¨PTX 2.xå¼•å…¥)</sup> and requires target architecture <code>sm_20</code>â€‹ or higher. Additional sub-qualifiers â€‹::entryâ€‹ or â€‹::funcâ€‹ can be specified on instructions with â€‹.paramâ€‹ state space to indicate whether the address refers to kernel function parameter or device function parameter<sup>(å¯ä»¥åœ¨.paramåé¢æŒ‡å®šé¢å¤–çš„å­é™å®šç¬¦::entryæˆ–::funcï¼Œæ¥æŒ‡ç¤ºåœ°å€æ˜¯å¦å¼•ç”¨å†…æ ¸å‡½æ•°æˆ–è®¾å¤‡å‡½æ•°å‚æ•°)</sup>. If no sub-qualifier is specified with the <code>.param</code>â€‹ state space, then the default sub-qualifier is specific to and dependent on the exact instruction. For example, <code>st.param</code>â€‹ is equivalent to <code>st.param::func</code>â€‹ whereas <code>isspacep.param</code>â€‹ is equivalent to <code>isspacep.param::entry</code>â€‹. Refer to the instruction description for more details on default sub-qualifier assumption.</p>
<blockquote>
<p>Note<sup>(è®²äº†ä¸€å¤§å †ï¼Œé‡å¿ƒè½åœ¨ç¬¬ä¸€å¥å’Œæœ€åä¸€å¥ï¼Œè¯´çš„æ˜¯ï¼š â€œç”±äº.paramç©ºé—´çš„ä½ç½®æ˜¯implementation specificï¼Œæ‰€ä»¥PTX code should no assumptions about the relative locations or ordering of .param space variables.â€)</sup></p>
<p>The location of parameter space is implementation specific. For example, in some implementations kernel parameters reside in global memory. No access protection is provided between parameter and global space in this case. Though the exact location of the kernel parameter space is implementation specific, the kernel parameter space window is always contained within the global space window. Similarly, function parameters are mapped to parameter passing registers and/or stack locations based on the function calling conventions of the <em>Application Binary Interface (ABI)</em> . Therefore, PTX code should make no assumptions about the relative locations or ordering of <code>.param</code>â€‹ space variables.</p></blockquote>
<h4 id="161-kernel-function-parameters">1.6.1 Kernel Function Parameters
</h4><p>Each kernel function definition includes an optional list of parameters. These parameters are addressable, read-only variables declared in the <code>.param</code>â€‹ state space. Values passed from the host to the kernel<sup>(å€¼ä»hoståˆ°kernelï¼Œç”¨ld.param )</sup> are accessed through these parameter variables using <code>ld.param</code>â€‹ instructions. The kernel parameter variables are shared across all CTAs from all clusters within a grid.<sup>(è¿™ä¹ˆå¤§èŒƒå›´çš„å…±äº«ï¼Œæˆ‘çŒœæ˜¯global)</sup></p>
<p>The address of a kernel parameter may be moved into a register using the â€‹movâ€‹ instruction. The resulting address is in the â€‹.paramâ€‹ state space and is accessed using â€‹ld.param<sup>(å†…æ ¸å‚æ•°çš„åœ°å€å¯ä»¥ç”¨movæ¥ç§»å…¥å¯„å­˜å™¨ï¼Œæ‹¿åˆ°çš„è¿™ä¸ªåœ°å€åœ¨.paramçŠ¶æ€ç©ºé—´ä¸­ï¼Œå¯ä»¥é€šè¿‡ld.paramæ¥è®¿é—®)</sup>â€‹ instructions.<sup>(å†…æ ¸å‚æ•°çš„åœ°å€å¯ä»¥ç”¨movæ¥ç§»å…¥å¯„å­˜å™¨ï¼Œæ‹¿åˆ°çš„è¿™ä¸ªåœ°å€åœ¨.paramçŠ¶æ€ç©ºé—´ä¸­ï¼Œå¯ä»¥é€šè¿‡ld.paramæ¥è®¿é—®)</sup></p>
<p><strong>Example<sup>(å¯¹äºè¿™ä¸ªç¤ºä¾‹ï¼Œ .entryæ˜¯ä¸€ä¸ªdirectiveï¼Œä»–ç”¨äºè¡¨æ˜æ­¤å¤„æ˜¯ä¸€ä¸ªå†…æ ¸å…¥å£ç‚¹ fooæ˜¯å‡½æ•°å .paramæ˜¯space state .b32è¡¨æ˜å‚æ•°æ˜¯32ä½çš„ï¼ˆbitï¼Ÿbinaryï¼Ÿï¼‰ .alignæ˜¯ä¸€ä¸ªdirectiveï¼Œå±äºVariablesï¼Œåé¢è·Ÿä¸€ä¸ªå¯é€‰çš„byte-countæ¥æŒ‡å®šå¯¹é½æ–¹å¼ åˆ°æ­£æ–‡     .reg .u32 %n;     .reg .f64 %d; æ„ä¸ºå£°æ˜ä¸€ä¸ª32ä½æ— ç¬¦å·æ•´æ•°å¯„å­˜å™¨ï¼Œå–åå«åšnï¼Œç”¨%nå¼•ç”¨ å£°æ˜ä¸€ä¸ª64ä½æµ®ç‚¹æ•°å¯„å­˜å™¨ï¼Œå–åå«åšdï¼Œç”¨%då¼•ç”¨ ç„¶åæ˜¯     ld.param.u32 %n, [N];     ld.param.f64 %d, [buffer]; ldæ˜¯ä¸€ä¸ªinstructionï¼Œï¼ˆld move data from addressable state space to registers.ï¼‰ è¡¨ç¤ºä»param state spaceä¸­åˆ†åˆ«ldä¸€ä¸ªu32å’Œf64çš„æ•°æ®)</sup></strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">.entry foo ( .param .b32 N, .param .align 8 .b8 buffer[64] )
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">    .reg .u32 %n;
</span></span><span class="line"><span class="cl">    .reg .f64 %d;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    ld.param.u32 %n, [N];
</span></span><span class="line"><span class="cl">    ld.param.f64 %d, [buffer];
</span></span><span class="line"><span class="cl">    ...
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Example<sup>(å’Œå‰ä¸€ä¸ªä¾‹å­å·®ä¸å¤š .entryè¡¨æ˜å‡½æ•°å…¥å£ baræ˜¯å‡½æ•°åç§° æœ‰ä¸€ä¸ªb32çš„å‚æ•°å«åšlen .reg .u32 %ptr,%n;å£°æ˜äº†ä¸¤ä¸ªu32çš„å¯„å­˜å™¨åˆ†åˆ«å«åšptrå’Œn movï¼ˆThe mov instructions copies data between registersï¼‰movæŒ‡ä»¤åœ¨registersä¹‹é—´å¤åˆ¶æ•°æ®ï¼Œä½†å®é™…ä¸Šè¿™é‡Œæ˜¯ä»state spaceåˆ°registerï¼Œåº”è¯¥éƒ½å¯ä»¥å§ mov.u32      %ptr, len;å°†lençš„å€¼å¤åˆ¶åˆ°ptrå¯„å­˜å™¨ä¸­å» ld.param.u32 %n, [%ptr];å°±æ˜¯ä»ptråŠ è½½ä¸€ä¸ªu32åˆ°nä¸­å»)</sup></strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">.entry bar ( .param .b32 len )
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">    .reg .u32 %ptr, %n;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    mov.u32      %ptr, len;
</span></span><span class="line"><span class="cl">    ld.param.u32 %n, [%ptr];
</span></span><span class="line"><span class="cl">    ...
</span></span></code></pre></td></tr></table>
</div>
</div><p>Kernel function parameters <sup>(parametersæ—¢å¯ä»¥ä¿ç•™æ•°æ®å€¼ä¹Ÿå¯ä»¥å­˜constã€globalã€local  or shared state spaceåœ°å€)</sup>may represent normal data values, or they may hold addresses to objects in constant, global, local, or shared state spaces. In the case of pointers, the compiler and runtime system need information about which parameters are pointers, and to which state space they point<sup>(å¦‚æœparametersæ˜¯æŒ‡é’ˆçš„è¯ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨å’Œè¿è¡Œæ—¶ç³»ç»Ÿå°±éœ€è¦å…³äºå“ªäº›å‚æ•°æ˜¯æŒ‡é’ˆï¼Œå¹¶ä¸”è¿™äº›æŒ‡é’ˆæŒ‡å‘å“ªäº›state spaceçš„ä¿¡æ¯ã€‚ å­˜åœ¨æä¾›è¿™äº›ä¿¡æ¯çš„directiveï¼Œå…·ä½“çš„å†…å®¹åœ¨Kernel Function Parameter Attributesé‡Œé¢çœ‹)</sup>. Kernel parameter attribute directives are used to provide this information at the PTX level. See <a class="link" href="https://docs.nvidia.com/cuda/parallel-thread-execution/index.html#kernel-function-parameter-attributes"  target="_blank" rel="noopener"
    >Kernel Function Parameter Attributes</a> for a description of kernel parameter attribute directives.</p>
<blockquote>
<p>Note<sup>(å‡ºç°äº†ä¸€ä¸ªæ–°çš„instructinoï¼Œcvtaï¼Œé¢„å‘Šä¸€ä¸‹ï¼Œè¿™ä¸ªinstructionåœ¨9.7.9.20)</sup></p>
<p>The current implementation does not allow creation of generic pointers to constant variables (<code>cvta.const</code>â€‹) in programs that have pointers to constant buffers passed as kernel parameters.</p></blockquote>
<h4 id="162-kernel-function-parameter-attributeså¯ä»¥ç”¨ptræ¥è¡¨æ˜è¯¥å‚æ•°æ˜¯æŒ‡å‘å†…å­˜çš„æŒ‡é’ˆè¿˜å¯ä»¥æŒ‡ç¤ºè¯¥æŒ‡é’ˆæ‰€æŒ‡å‘å†…å­˜çš„çŠ¶æ€ç©ºé—´å’Œå¯¹é½æ–¹å¼">1.6.2 Kernel Function Parameter Attributes<sup>(å¯ä»¥ç”¨.ptræ¥è¡¨æ˜è¯¥å‚æ•°æ˜¯æŒ‡å‘å†…å­˜çš„æŒ‡é’ˆï¼Œè¿˜å¯ä»¥æŒ‡ç¤ºè¯¥æŒ‡é’ˆæ‰€æŒ‡å‘å†…å­˜çš„çŠ¶æ€ç©ºé—´å’Œå¯¹é½æ–¹å¼)</sup>
</h4><p>Kernel function parameters may be declared with an optional .ptr attribute to indicate that a parameter is a pointer to memory, and also indicate the state space and alignment of the memory being pointed to. <a class="link" href="https://docs.nvidia.com/cuda/parallel-thread-execution/index.html#kernel-parameter-attribute-ptr"  target="_blank" rel="noopener"
    >Kernel Parameter Attribute: .ptr</a> describes the <code>.ptr</code>â€‹ kernel parameter attribute.</p>
<h4 id="163-kernel-parameter-attributeptr">1.6.3 Kernel Parameter Attributeï¼š.ptr
</h4><p><strong>.ptr</strong></p>
<p>Kernel parameter alignment attribute.</p>
<p><strong>Syntax<sup>(è¿™é‡Œçš„.typeå°±æ˜¯u32ä¹‹ç±»çš„ï¼Œè¿™é‡Œçš„.spaceå°±æ˜¯state space)</sup></strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="o">.</span><span class="n">param</span> <span class="o">.</span><span class="n">type</span> <span class="o">.</span><span class="n">ptr</span> <span class="o">.</span><span class="n">space</span> <span class="o">.</span><span class="n">align</span> <span class="n">N</span>  <span class="n">varname</span>
</span></span><span class="line"><span class="cl"><span class="o">.</span><span class="n">param</span> <span class="o">.</span><span class="n">type</span> <span class="o">.</span><span class="n">ptr</span>        <span class="o">.</span><span class="n">align</span> <span class="n">N</span>  <span class="n">varname</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">.</span><span class="n">space</span> <span class="o">=</span> <span class="p">{</span> <span class="o">.</span><span class="k">const</span><span class="p">,</span> <span class="o">.</span><span class="n">global</span><span class="p">,</span> <span class="o">.</span><span class="n">local</span><span class="p">,</span> <span class="o">.</span><span class="n">shared</span> <span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>Description</strong></p>
<p>Used to specify the state space and, optionally, the alignment<sup>(alignmentæ˜¯å¯é€‰çš„)</sup> of memory pointed to by a pointer type kernel parameter. The alignment value <em>N</em>, if present, must be a power of two. If no state space is specified, the pointer is assumed to be a generic address pointing to one of const, global, local, or shared memory<sup>(å¦‚æœæ²¡æœ‰æŒ‡å‘state spaceï¼Œé‚£ä¹ˆè¿™ä¸ªæŒ‡é’ˆå°±è¢«å‡å®šä¸ºæŒ‡å‘constã€globalã€local or shared memoryçš„é€šç”¨åœ°å€)</sup>. If no alignment is specified, the memory pointed to is assumed to be aligned to a 4 byte boundary.<sup>(å¦‚æœæ²¡æœ‰æŒ‡å®šalignmentï¼Œé‚£ä¹ˆå°±é»˜è®¤å¯¹é½4byte)</sup></p>
<p>Spaces between â€‹.ptrâ€‹, â€‹.spaceâ€‹, and â€‹.alignâ€‹ may be eliminated to improve readability.<sup>(è¿™ä¹‹é—´çš„ç©ºæ ¼ä¹Ÿå¯ä»¥æ¶ˆé™¤)</sup>â€‹</p>
<p><strong>PTX ISA Notes</strong></p>
<ul>
<li>Introduced in PTX ISA version 2.2.</li>
<li>Support for generic addressing of .const space added in PTX ISA version 3.1.</li>
</ul>
<p><strong>Target ISA Notes</strong></p>
<ul>
<li>Supported on all target architectures.</li>
</ul>
<p><strong>Examples<sup>(è¿™ä¸ªä¾‹å­å¾ˆæ¸…æ™°ï¼Œæ˜¯æŒ‰ç…§å‰é¢è¯´çš„è¯­æ³•æ¥çš„ )</sup></strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="o">.</span><span class="n">entry</span> <span class="n">foo</span> <span class="p">(</span> <span class="o">.</span><span class="n">param</span> <span class="o">.</span><span class="n">u32</span> <span class="n">param1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">             <span class="o">.</span><span class="n">param</span> <span class="o">.</span><span class="n">u32</span> <span class="o">.</span><span class="n">ptr</span><span class="o">.</span><span class="n">global</span><span class="o">.</span><span class="n">align</span> <span class="mi">16</span> <span class="n">param2</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">             <span class="o">.</span><span class="n">param</span> <span class="o">.</span><span class="n">u32</span> <span class="o">.</span><span class="n">ptr</span><span class="o">.</span><span class="k">const</span><span class="o">.</span><span class="n">align</span> <span class="mi">8</span> <span class="n">param3</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">             <span class="o">.</span><span class="n">param</span> <span class="o">.</span><span class="n">u32</span> <span class="o">.</span><span class="n">ptr</span><span class="o">.</span><span class="n">align</span> <span class="mi">16</span> <span class="n">param4</span>  <span class="o">//</span> <span class="n">generic</span> <span class="n">address</span>
</span></span><span class="line"><span class="cl">                                               <span class="o">//</span> <span class="n">pointer</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span> <span class="p">{</span> <span class="o">..</span> <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="164-device-function-parameters">1.6.4 Device Function Parameters
</h4><p>PTX ISA version 2.0 extended the use of parameter space to device function parameters<sup>(è¿™ä¸€æ®µæœ‰ç‚¹å¤æ‚ï¼Œæ€»ä¹‹å°±æ˜¯åœ¨PTX ISA2ä¸­æ‰©å±•äº†parameterç©ºé—´å¯¹è®¾å¤‡å‡½æ•°å‚æ•°çš„ä½¿ç”¨)</sup>. The most common use is for passing objects by value that do not fit within a PTX register, such as C structures larger than 8 bytes. In this case, a byte array in parameter space is used. Typically, the caller will declare a locally-scoped <code>.param</code>â€‹ byte array variable that represents a flattened C structure or union. This will be passed by value to a callee, which declares a <code>.param</code>â€‹ formal parameter having the same size and alignment as the passed argument.</p>
<p><strong>Example<sup>(æœ‰ä¸€ç‚¹æ„å¤–ï¼Œè¿™é‡Œå‚æ•°.param .align 8 .b8 buffer[12]é‡Œé¢çš„ .8çš„æ„æ€æ˜¯buffer[12]é‡Œé¢çš„æ•°æ®æ˜¯å­—èŠ‚ï¼Œå³bufferæ˜¯ä¸€ä¸ªå­—èŠ‚æ•°ç»„ï¼Œå¦‚æœå°†è¿™é‡Œçš„.b8æ”¹æˆf64ï¼Œåˆ™è¡¨æ˜è¿™ä¸ªbufferæ˜¯ä¸€ä¸ªdoubleæ•°ç»„ï¼Œè¯´æ˜å‰é¢çš„ç†è§£æ˜¯ä¸åˆ°ä½çš„ã€‚ è¿™ä¸€ä¸ªç¤ºä¾‹å¯¹.typeè¿™æ ·çš„ptxçš„è¯´æ˜å¾ˆæ¸…æ™° ç¬¬ä¸€æ®µæ˜¯å‡½æ•°å®ç°ï¼Œè¿™ä¸ªå‡½æ•°çš„å…·ä½“çš„å†…å®¹ ç¬¬äºŒæ®µæ˜¯å‡½æ•°çš„è°ƒç”¨ï¼šcall foo,ï¼ˆ4ï¼Œmystructï¼‰; çœ‹ç¬¬äºŒæ®µæœ‰ä¸€ä¸ªåŒ…æ‹¬äº†doubleå’Œintçš„ç»“æ„ä½“ï¼ŒåŠ åœ¨ä¸€èµ·8+4=12å­—èŠ‚ï¼Œè¶…è¿‡äº†8å­—èŠ‚ï¼Œå¦‚ä¸Šè¿°æ‰€è¯´çš„ä½¿ç”¨ï¼Œå°±éœ€è¦ç”¨paramç©ºé—´äº† å‰é¢é‡åˆ°è¿‡ldï¼Œé¡ºä¾¿çœ‹äº†ä¸€ä¸‹stï¼Œstçš„æ„æ€æ˜¯from register to memory ç”±äºmystructæ˜¯ç”±ä¸€ä¸ªdoubleå’Œä¸€ä¸ªintç»„æˆçš„ï¼Œ æ‰€ä»¥ä»–è¿™é‡Œæ˜¯å…ˆå°†8å­—èŠ‚å¤§å°çš„f64 dblæ”¾å…¥mystructé‡Œé¢ ç„¶ååç§»8å­—èŠ‚å†æ”¾å…¥4å­—èŠ‚å¤§å°çš„s32 xï¼Œåœ¨ä¼ å…¥fooè°ƒç”¨)</sup></strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="o">//</span> <span class="k">pass</span> <span class="n">object</span> <span class="n">of</span> <span class="n">type</span> <span class="n">struct</span> <span class="p">{</span> <span class="n">double</span> <span class="n">d</span><span class="p">;</span> <span class="ne">int</span> <span class="n">y</span><span class="p">;</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="o">.</span><span class="k">func</span> <span class="n">foo</span> <span class="p">(</span> <span class="o">.</span><span class="n">reg</span> <span class="o">.</span><span class="n">b32</span> <span class="n">N</span><span class="p">,</span> <span class="o">.</span><span class="n">param</span> <span class="o">.</span><span class="n">align</span> <span class="mi">8</span> <span class="o">.</span><span class="n">b8</span> <span class="n">buffer</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">reg</span> <span class="o">.</span><span class="n">f64</span> <span class="o">%</span><span class="n">d</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">reg</span> <span class="o">.</span><span class="n">s32</span> <span class="o">%</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">ld</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">f64</span> <span class="o">%</span><span class="n">d</span><span class="p">,</span> <span class="p">[</span><span class="n">buffer</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="n">ld</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">s32</span> <span class="o">%</span><span class="n">y</span><span class="p">,</span> <span class="p">[</span><span class="n">buffer</span><span class="o">+</span><span class="mi">8</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="o">//</span> <span class="n">code</span> <span class="n">snippet</span> <span class="n">from</span> <span class="n">the</span> <span class="n">caller</span>
</span></span><span class="line"><span class="cl"><span class="o">//</span> <span class="n">struct</span> <span class="p">{</span> <span class="n">double</span> <span class="n">d</span><span class="p">;</span> <span class="ne">int</span> <span class="n">y</span><span class="p">;</span> <span class="p">}</span> <span class="n">mystruct</span><span class="p">;</span> <span class="n">is</span> <span class="n">flattened</span><span class="p">,</span> <span class="n">passed</span> <span class="n">to</span> <span class="n">foo</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">reg</span> <span class="o">.</span><span class="n">f64</span> <span class="n">dbl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">reg</span> <span class="o">.</span><span class="n">s32</span> <span class="n">x</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">param</span> <span class="o">.</span><span class="n">align</span> <span class="mi">8</span> <span class="o">.</span><span class="n">b8</span> <span class="n">mystruct</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span>
</span></span><span class="line"><span class="cl">    <span class="n">st</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">f64</span> <span class="p">[</span><span class="n">mystruct</span><span class="o">+</span><span class="mi">0</span><span class="p">],</span> <span class="n">dbl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">st</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">s32</span> <span class="p">[</span><span class="n">mystruct</span><span class="o">+</span><span class="mi">8</span><span class="p">],</span> <span class="n">x</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">call</span> <span class="n">foo</span><span class="p">,</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">mystruct</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>See the section on function call syntax for more details.</p>
<p>Function input parameters may be read via <code>ld.param</code>â€‹ and function return parameters may be written using <code>st.param</code>â€‹; it is illegal to write to an input parameter or read from a return parameter.<sup>(æ²¡æœ‰å…·ä½“ç¤ºä¾‹ï¼Œä¸æ˜¯å¾ˆæ‡‚è¿™ä¸ªéæ³•åœºæ™¯)</sup></p>
<p>Aside from passing structures by value, <code>.param</code>â€‹ space is also required whenever a formal parameter has its address taken within the called function. In PTX, the address of a function input parameter may be moved into a register using the <code>mov</code>â€‹ instruction. Note that the parameter will be copied to the stack if necessary, and so the address will be in the <code>.local</code>â€‹ state space and is accessed via <code>ld.local</code>â€‹ and <code>st.local</code>â€‹ instructions. It is not possible to use <code>mov</code>â€‹ to get the address of or a locally-scoped <code>.param</code>â€‹ space variable. Starting PTX ISA version 6.0, it is possible to use <code>mov</code>â€‹ instruction to get address of return parameter of device function.</p>
<p><strong>Example<sup>(å‡ºç°äº†ä¸€ä¸ªæ–°çš„instructionï¼Œåœ¨9.7.12.2é‡Œé¢è¢«ç§°ä¸ºcontrol flow instructionsåŒ…æ‹¬ï¼š{}ã€@ã€braã€callã€retã€exit åº”è¯¥å°±æ˜¯è·³è½¬ï¼ˆbranchï¼‰çš„æ„æ€ å‡ºç°äº†ä¸€ä¸ªæ–°çš„type specifierï¼ˆ9.3ï¼‰ï¼Œ.predï¼Œé•¿çš„å¾ˆåƒinstructionï¼Œä½†æ˜¯æ²¡åœ¨instructionåˆ—è¡¨é‡Œé¢æ‰¾åˆ°ä»–ï¼Œä½œç”¨åº”è¯¥åªæ˜¯ç”¨äºè¡¨æ˜æ­¤å˜é‡æ˜¯è°“è¯å˜é‡ï¼ˆæ¯”å¤§å°ï¼Ÿå¸ƒå°”ç±»å‹ï¼Ÿï¼‰ å‡ºç°äº†ä¸€ä¸ªæ–°çš„instructionï¼Œåœ¨9.7.6é‡Œé¢è¢«ç§°ä¸ºcomparison and selection instructionsåŒ…æ‹¬setã€setpã€selpã€slct ä»–å¦ˆçš„çœ‹ä¸Šå»setå’Œsetpæ˜¯ä¸€æ ·çš„ï¼Œdamn è¿™é‡Œçš„eqæ˜¯comparison operatorsåœ¨9.3.1comparisoné‡Œé¢æœ‰æè¿° å€¼å¾—ä¸€æçš„æ˜¯è¿™ä¸ªloopæ²¡æœ‰æ–‡æ¡£çš„æè¿°ï¼ˆæ˜¾ç„¶çŒœæµ‹ä¸ºæ™®é€šçš„å¾ªç¯ï¼‰ è¿™ä¸ªä¾‹å­ä¸­ç¬¬ä¸€æ¬¡å‡ºç°äº†åœ¨å£°æ˜å¯„å­˜å™¨å˜é‡çš„æ—¶å€™ç”¨.predè¡¨æ˜è¿™ä¸ªå˜é‡æ˜¯è°“è¯ç±»å‹ï¼ˆæ®AIè¯´è¿™æ˜¯boolç±»å‹ï¼‰ @%p bra         Done;è¿™é‡Œçš„æ•´ä¸ªå¾ªç¯æ˜¯å¦‚æœ%pä¸ºtrueåˆ™è·³è½¬åˆ°Doneï¼Œå³ç»“æŸå¾ªç¯ è¿™ä¹‹å‰æœ‰ä¸€å¥setp.eq.u32  %p, %n, 0;ä¼šä¸€ç›´åšnå’Œ0çš„åˆ¤æ–­ï¼Œå¦‚æœnç­‰äº0ï¼Œåˆ™å°†pè®¾ç½®ä¸ºtrueï¼Œå³è‹¥nä¸º0ï¼Œåˆ™è·³å‡ºå¾ªç¯ï¼Œå»Done å¾ªç¯ä½“é‡Œé¢æœ‰ä¸€ä¸ªsubæŒ‡ä»¤ï¼Œè¡¨æ˜æ¯æ¬¡å¾ªç¯néƒ½ä¼šè‡ªå‡ä¸€æ¬¡ï¼Œæ‰€ä»¥è¿™ä¸ªå¾ªç¯è¿˜æ˜¯å¾ˆå®Œæ•´åˆç†çš„ã€‚)</sup></strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="o">//</span> <span class="k">pass</span> <span class="n">array</span> <span class="n">of</span> <span class="n">up</span> <span class="n">to</span> <span class="n">eight</span> <span class="n">floating</span><span class="o">-</span><span class="n">point</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">buffer</span>
</span></span><span class="line"><span class="cl"><span class="o">.</span><span class="k">func</span> <span class="n">foo</span> <span class="p">(</span> <span class="o">.</span><span class="n">param</span> <span class="o">.</span><span class="n">b32</span> <span class="n">N</span><span class="p">,</span> <span class="o">.</span><span class="n">param</span> <span class="o">.</span><span class="n">b32</span> <span class="n">buffer</span><span class="p">[</span><span class="mi">32</span><span class="p">]</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">reg</span> <span class="o">.</span><span class="n">u32</span>  <span class="o">%</span><span class="n">n</span><span class="p">,</span> <span class="o">%</span><span class="n">r</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">reg</span> <span class="o">.</span><span class="n">f32</span>  <span class="o">%</span><span class="n">f</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="o">.</span><span class="n">reg</span> <span class="o">.</span><span class="n">pred</span> <span class="o">%</span><span class="n">p</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">ld</span><span class="o">.</span><span class="n">param</span><span class="o">.</span><span class="n">u32</span> <span class="o">%</span><span class="n">n</span><span class="p">,</span> <span class="p">[</span><span class="n">N</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="n">mov</span><span class="o">.</span><span class="n">u32</span>      <span class="o">%</span><span class="n">r</span><span class="p">,</span> <span class="n">buffer</span><span class="p">;</span>  <span class="o">//</span> <span class="n">forces</span> <span class="n">buffer</span> <span class="n">to</span> <span class="o">.</span><span class="n">local</span> <span class="n">state</span> <span class="n">space</span>
</span></span><span class="line"><span class="cl"><span class="n">Loop</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">setp</span><span class="o">.</span><span class="n">eq</span><span class="o">.</span><span class="n">u32</span>  <span class="o">%</span><span class="n">p</span><span class="p">,</span> <span class="o">%</span><span class="n">n</span><span class="p">,</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="err">@</span><span class="o">%</span><span class="n">p</span> <span class="n">bra</span>         <span class="n">Done</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">ld</span><span class="o">.</span><span class="n">local</span><span class="o">.</span><span class="n">f32</span> <span class="o">%</span><span class="n">f</span><span class="p">,</span> <span class="p">[</span><span class="o">%</span><span class="n">r</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span>
</span></span><span class="line"><span class="cl">    <span class="n">add</span><span class="o">.</span><span class="n">u32</span>      <span class="o">%</span><span class="n">r</span><span class="p">,</span> <span class="o">%</span><span class="n">r</span><span class="p">,</span> <span class="mi">4</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">sub</span><span class="o">.</span><span class="n">u32</span>      <span class="o">%</span><span class="n">n</span><span class="p">,</span> <span class="o">%</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">bra</span>          <span class="n">Loop</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">Done</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="17-shared-state-space">1.7 Shared State Space
</h3><p>The shared (<code>.shared</code>â€‹) state space is a memory that is owned by an executing CTA and is accessible to the threads of all the CTAs within a cluster<sup>(shared state spaceå±…ç„¶æ˜¯accessible to the threads of all the CTAs within a clusterï¼Œä½†æ˜¯æˆ‘çŒœæ˜¯åªæœ‰CTAå†…éƒ¨æ‰èƒ½é€šä¿¡ï¼Œè™½ç„¶æ•´ä¸ªclusterså¯ä»¥è®¿é—®)</sup>. An address in shared memory can be read and written by any thread in a CTA cluster.</p>
<p>Additional sub-qualifiers<sup>(ä»–è¿™é‡Œè¡¨æ˜åœ¨.shared ä¹‹åå¯ä»¥æŒ‡å®š::ctaæˆ–è€…::clusteræ¥è¡¨æ˜è¿™ä¸ªsharedåœ°å€æ˜¯å±äºæ­£æ‰§è¡Œçš„CTAè¿˜æ˜¯clusterä¸­ä»»ä½•CTAçš„å…±äº«å†…å­˜çª—å£ã€‚.shared::cta çª—å£ä¸­çš„åœ°å€ä¹ŸåŒ…å«åœ¨ .shared::clusterçª—å£ä¸­ã€‚å¦‚æœæ²¡æœ‰æŒ‡å®šåˆ™é»˜è®¤æ˜¯::ctaï¼Œä¾‹å¦‚ï¼šld.shared ç›¸å½“äº ld.shared::cta)</sup> <code>::cta</code>â€‹ or <code>::cluster</code>â€‹ can be specified on instructions with <code>.shared</code>â€‹ state space to indicate whether the address belongs to the shared memory window of the executing CTA or of any CTA in the cluster respectively. The addresses in the <code>.shared::cta</code>â€‹ window also fall within the <code>.shared::cluster</code>â€‹ window. If no sub-qualifier is specified with the <code>.shared</code>â€‹ state space, then it defaults to <code>::cta</code>â€‹. For example, <code>ld.shared</code>â€‹ is equivalent to <code>ld.shared::cta</code>â€‹.</p>
<p>Variables declared in â€‹.sharedâ€‹ state space refer to the memory addresses in the current CTA. Instruction â€‹mapaâ€‹ gives the â€‹.shared::cluster<sup>(.sharedæŒ‡å‘å½“å‰CTAä¸­çš„å†…å­˜åœ°å€ï¼Œmapaç»™å‡ºäº†åœ¨åŒä¸€clusteré‡Œé¢å…¶ä»–CTAçš„åœ°å€)</sup>â€‹ address of the corresponding variable in another CTA in the cluster.<sup>(.sharedæŒ‡å‘å½“å‰CTAä¸­çš„å†…å­˜åœ°å€ï¼Œmapaç»™å‡ºäº†åœ¨åŒä¸€clusteré‡Œé¢å…¶ä»–CTAçš„åœ°å€)</sup></p>
<p>Shared memory typically has some optimizations to support the sharing. One example is broadcast<sup>(sharedçš„ä¼˜åŒ–æ–¹æ¡ˆä¾‹å­â€”â€”â€”â€”â€”â€”å¹¿æ’­)</sup>; where all threads read from the same address. Another is sequential access from sequential threads.</p>
<h3 id="18-texture-state-spacedeprecated">1.8 Texture State Spaceï¼ˆdeprecatedï¼‰
</h3><p>The texture (<code>.tex</code>â€‹) state space is global memory accessed via the texture instruction. It is shared by all threads in a context. Texture memory is read-only and cached, so accesses to texture memory are not coherent with global memory stores to the texture image.</p>
<p>The GPU hardware has a fixed number of texture bindings that can be accessed within a single kernel (typically 128). The .tex directive will bind the named texture memory variable to a hardware texture identifier, where texture identifiers are allocated sequentially beginning with zero. Multiple names may be bound to the same physical texture identifier. An error is generated if the maximum number of physical resources is exceeded. The texture name must be of type <code>.u32</code>â€‹ or <code>.u64</code>â€‹.</p>
<p>Physical texture resources are allocated on a per-kernel granularity, and <code>.tex</code>â€‹ variables are required to be defined in the global scope.</p>
<p>Texture memory is read-only. A textureâ€™s base address is assumed to be aligned to a 16 byte boundary.</p>
<p><strong>Example</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">.tex .u32 tex_a;         // bound to physical texture 0
</span></span><span class="line"><span class="cl">.tex .u32 tex_c, tex_d;  // both bound to physical texture 1
</span></span><span class="line"><span class="cl">.tex .u32 tex_d;         // bound to physical texture 2
</span></span><span class="line"><span class="cl">.tex .u32 tex_f;         // bound to physical texture 3
</span></span></code></pre></td></tr></table>
</div>
</div><p>Note</p>
<p>Explicit declarations of variables in the texture state space is deprecated, and programs should instead reference texture memory through variables of type <code>.texref</code>â€‹. The <code>.tex</code>â€‹ directive is retained for backward compatibility, and variables declared in the <code>.tex</code>â€‹ state space are equivalent to module-scoped <code>.texref</code>â€‹ variables in the <code>.global</code>â€‹ state space.</p>
<p>For example, a legacy PTX definitions such as</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">.tex .u32 tex_a;
</span></span></code></pre></td></tr></table>
</div>
</div><p>is equivalent to:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">.global .texref tex_a;
</span></span></code></pre></td></tr></table>
</div>
</div><p>See <a class="link" href="https://docs.nvidia.com/cuda/parallel-thread-execution/index.html#texture-sampler-and-surface-types"  target="_blank" rel="noopener"
    >Texture Sampler and Surface Types</a> for the description of the <code>.texref</code>â€‹ type and <a class="link" href="https://docs.nvidia.com/cuda/parallel-thread-execution/index.html#texture-instructions"  target="_blank" rel="noopener"
    >Texture Instructions</a> for its use in texture instructions.</p>
<h2 id="2-tpyes">2. Tpyes
</h2><h3 id="21-fundamental-types">2.1 Fundamental Types
</h3><p>In PTX, the fundamental types reflect the native data types supported by the target architectures. A fundamental type specifies both a basic type and a size<sup>(ä¸€ä¸ªtypeç”±basic typeå’Œsizeç»„æˆ)</sup>. Register variables are always of a fundamental type, and instructions operate on these types. The same type-size specifiers are used for both variable definitions and for typing instructions, so their names are intentionally short.<sup>(è¿™é‡Œè¯´äº†type specifiersåˆ°å¤„éƒ½åœ¨ç”¨ï¼Œæ‰€ä»¥è®¾è®¡çš„å¾ˆçŸ­)</sup></p>
<p><a class="link" href="https://docs.nvidia.com/cuda/parallel-thread-execution/index.html#fundamental-types-fundamental-type-specifiers"  target="_blank" rel="noopener"
    >Table 8</a> lists the fundamental type specifiers for each basic type:</p>
<p>â€‹<img src="http://127.0.0.1:3622/assets/image-20250220152438-qg4b3sq.png"
	
	
	
	loading="lazy"
	
		alt="image"
	
	
>â€‹</p>
<p>Most instructions have one or more type specifiers, needed to fully specify instruction behavior. Operand types and sizes are checked against instruction types for compatibility.</p>
<p>Two fundamental types are compatible if they have the same basic type and are the same size. Signed and unsigned integer types are compatible if they have the same size. The bit-size type is compatible with any fundamental type having the same size.</p>
<p>In principle, all variables (aside from predicates) could be declared using only bit-size types<sup>(æ‰€æœ‰çš„å˜é‡ï¼ˆé™¤äº†è°“è¯ä»¥å¤–ï¼‰éƒ½å¯ä»¥ä»…ä½¿ç”¨ä½å¤§å°ç±»å‹æ¥å£°æ˜)</sup>, but typed variables enhance program readability and allow for better operand type checking.</p>
<h3 id="22-restricted-use-of-sub-word-sizes">2.2 Restricted Use of Sub-Word Sizes
</h3><p>The â€‹.u8â€‹, â€‹.s8â€‹, and â€‹.b8â€‹ instruction types are restricted to â€‹ldâ€‹, â€‹stâ€‹, and â€‹cvtâ€‹ instructions<sup>(u8ã€s8å’Œb8ä»…é™äºldã€stå’Œcvtä½¿ç”¨)</sup>. The <code>.f16</code>â€‹ floating-point type is allowed only in conversions to and from <code>.f32</code>â€‹, <code>.f64</code>â€‹ types, in half precision floating point instructions and texture fetch instructions. The <code>.f16x2</code>â€‹ floating point type is allowed only in half precision floating point arithmetic instructions and texture fetch instructions.</p>
<p>For convenience<sup>(ä¸ºäº†æ–¹ä¾¿ï¼Œldã€stå’Œcvtå…è®¸æºå’Œç›®çš„æ“ä½œæ•°æ¯”æŒ‡ä»¤æœ¬èº«è¦æ±‚çš„ç±»å‹å¤§å°è¦å¤§)</sup>, <code>ld</code>â€‹, <code>st</code>â€‹, and <code>cvt</code>â€‹ instructions permit source and destination data operands to be wider than the instruction-type size, so that narrow values may be loaded, stored, and converted using regular-width registers. For example, 8-bit or 16-bit values may be held directly in 32-bit or 64-bit registers when being loaded, stored, or converted to other types and sizes.</p>
<h3 id="23-alternate-floating-point-data-formats">2.3 Alternate Floating-Point Data Formats
</h3><p>The fundamental floating-point types supported in PTX have implicit bit representations<sup>(PTXæ”¯æŒçš„åŸºæœ¬æµ®ç‚¹ç±»å‹å…·æœ‰éšå¼çš„ä½è¡¨ç¤ºï¼ŒæŒ‡ç¤ºç”¨äºå­˜å‚¨æŒ‡æ•°å’Œå°¾æ•°çš„ä½æ•°ã€‚ä¾‹å¦‚f16éšå¼ä¸ºe5m10)</sup> that indicate the number of bits used to store exponent and mantissa. For example, the <code>.f16</code>â€‹ type indicates 5 bits reserved for exponent and 10 bits reserved for mantissa. In addition to the floating-point representations assumed by the fundamental types, PTX allows the following alternate floating-point data formats:</p>
<p>â€‹bf16<sup>(8e7m)</sup>â€‹ <strong>data format</strong>:This data format is a 16-bit floating point format with 8 bits for exponent and 7 bits for mantissa. A register variable containing â€‹bf16â€‹ data must be declared with â€‹.b16<sup>(åŒ…å«bf16æ•°æ®çš„å¯„å­˜å™¨å˜é‡å¿…é¡»ä½¿ç”¨.b16ç±»å‹å£°æ˜)</sup>â€‹ type.<sup>(åŒ…å«bf16æ•°æ®çš„å¯„å­˜å™¨å˜é‡å¿…é¡»ä½¿ç”¨.b16ç±»å‹å£°æ˜)</sup></p>
<p>â€‹<code>e4m3</code>â€‹ <strong>data format</strong>:This data format is an 8-bit floating point format with 4 bits for exponent and 3 bits for mantissa. The â€‹e4m3â€‹ encoding does not support infinity and â€‹NaNâ€‹ values are limited to â€‹0x7fâ€‹ and â€‹0xffâ€‹. A register variable containing â€‹e4m3<sup>(e4m3ä¸æ”¯æŒæ— é™å¤§ï¼Œå¦‚æœä½¿ç”¨e4m3åˆ™0x7få’Œ0xffå°±ä¼šå¯¼è‡´NaN åŒ…å«e4m3çš„å¯„å­˜å™¨å˜é‡å¿…é¡»ç”¨ä½å¤§å°ç±»å‹å£°æ˜)</sup>â€‹ value must be declared using bit-size type.<sup>(e4m3ä¸æ”¯æŒæ— é™å¤§ï¼Œå¦‚æœä½¿ç”¨e4m3åˆ™0x7få’Œ0xffå°±ä¼šå¯¼è‡´NaN åŒ…å«e4m3çš„å¯„å­˜å™¨å˜é‡å¿…é¡»ç”¨ä½å¤§å°ç±»å‹å£°æ˜)</sup></p>
<p>â€‹<code>e5m2</code>â€‹ <strong>data format</strong>:This data format is an 8-bit floating point format with 5 bits for exponent and 2 bits for mantissa. A register variable containing â€‹e5m2<sup>(åŒæ ·çš„ï¼ŒåŒ…å«e5m2çš„å¯„å­˜å™¨å¿…é¡»ç”¨ä½å¤§å°ç±»å‹å£°æ˜)</sup>â€‹ value must be declared using bit-size type.<sup>(åŒæ ·çš„ï¼ŒåŒ…å«e5m2çš„å¯„å­˜å™¨å¿…é¡»ç”¨ä½å¤§å°ç±»å‹å£°æ˜)</sup></p>
<p>â€‹<code>tf32</code>â€‹ <strong>data format</strong>:This data format is a special 32-bit floating point format supported by the matrix multiply-and-accumulate instructions, with the same range as <code>.f32</code>â€‹ and reduced precision (&gt;=10 bits). The internal layout of <code>tf32</code>â€‹ format is implementation defined. PTX facilitates conversion from single precision â€‹.f32â€‹ type to â€‹tf32â€‹ format. A register variable containing â€‹tf32â€‹ data must be declared with â€‹.b32<sup>(ptxæ”¯æŒä»å•ç²¾åº¦f32åˆ°tf32çš„è½¬æ¢ï¼ŒåŒ…å«tf32çš„å¯„å­˜å™¨å˜é‡å¿…é¡»ä½¿ç”¨b32ç±»å‹å£°æ˜)</sup>â€‹ type.<sup>(ptxæ”¯æŒä»å•ç²¾åº¦f32åˆ°tf32çš„è½¬æ¢ï¼ŒåŒ…å«tf32çš„å¯„å­˜å™¨å˜é‡å¿…é¡»ä½¿ç”¨b32ç±»å‹å£°æ˜)</sup></p>
<p>â€‹<code>e2m1</code>â€‹ <strong>data format</strong>:This data format is a 4-bit floating point format with 2 bits for exponent and 1 bit for mantissa. The â€‹e2m1â€‹ encoding does not support infinity and â€‹NaN<sup>(e2m1ä¹Ÿä¸æ”¯æŒæ— é™å¤§)</sup>â€‹. e2m1â€‹ values must be used in a packed format specified as â€‹e2m1x2â€‹. A register variable containing two â€‹e2m1â€‹ values must be declared with â€‹.b8<sup>(e2m1å¿…é¡»ä»¥æŒ‡å®šçš„å‹ç¼©æ ¼å¼e2m1x2ä½¿ç”¨ï¼ŒåŒ…å«ä¸¤ä¸ªe2m1å€¼çš„å¯„å­˜å™¨å˜é‡å¿…é¡»ä½¿ç”¨.b8ç±»å‹å£°æ˜)</sup>â€‹ type.<sup>(e2m1å¿…é¡»ä»¥æŒ‡å®šçš„å‹ç¼©æ ¼å¼e2m1x2ä½¿ç”¨ï¼ŒåŒ…å«ä¸¤ä¸ªe2m1å€¼çš„å¯„å­˜å™¨å˜é‡å¿…é¡»ä½¿ç”¨.b8ç±»å‹å£°æ˜)</sup></p>
<p>â€‹<code>e2m3</code>â€‹ <strong>data format</strong>:This data format is a 6-bit floating point format with 2 bits for exponent and 3 bits for mantissa. The â€‹e2m3â€‹ encoding does not support infinity and â€‹NaN<sup>(e2m3ä¸æ”¯æŒæ— é™å¤§å’ŒNaN)</sup>â€‹. e2m3<sup>(e2m3å¿…é¡»ç”¨packedæ ¼å¼e2m3x2ä½¿ç”¨)</sup>â€‹ values must be used in a packed format specified as <sup>(e2m3å¿…é¡»ä»¥æŒ‡å®šçš„packedæ ¼å¼e2m3x2ä½¿ç”¨)</sup>â€‹e2m3x2<sup>(e2m3å¿…é¡»ç”¨packedæ ¼å¼e2m3x2ä½¿ç”¨)</sup>â€‹. A register variable containing two <code>e2m3</code>â€‹ values must be declared with â€‹.b16â€‹ type<sup>(e2m3å¿…é¡»å£°æ˜ä¸º.b16ç±»å‹ï¼Œ)</sup> where each <code>.b8</code>â€‹ element has 6-bit floating point value and 2 MSB bits padded with zeros.</p>
<p>â€‹<code>e3m2</code>â€‹ <strong>data format</strong>:This data format is a 6-bit floating point format with 3 bits for exponent and 2 bits for mantissa. The â€‹e3m2â€‹ encoding does not support infinity and â€‹NaN<sup>(e3m2ä¸æ”¯æŒæ— é™å¤§å’ŒNaN)</sup>. <code>e3m2</code>â€‹ values must be used in a packed format specified as â€‹e3m2x2<sup>(e3m2å¿…é¡»ä»¥æŒ‡å®šçš„æ‰“åŒ…æ ¼å¼e3m2x2ä½¿ç”¨)</sup>â€‹. A register variable containing two <code>e3m2</code>â€‹ values must be declared with â€‹.b16â€‹ type <sup>(åŒ…å«ä¸¤ä¸ªe3m2å€¼çš„å¯„å­˜å™¨å˜é‡å¿…é¡»å£°æ˜ä¸º.b16ç±»å‹ï¼Œå…¶ä¸­æ¯ä¸ª.b8å…ƒç´ å…·æœ‰6ä¸ºæµ®ç‚¹æ•°ï¼Œå¹¶ä¸”é«˜ä¸¤ä½ç”¨0å¡«å……)</sup>where each <code>.b8</code>â€‹ element has 6-bit floating point value and 2 MSB bits padded with zeros.</p>
<p>â€‹<code>ue8m0</code>â€‹ <strong>data format</strong>:This data format is an 8-bit unsigned floating-point format with 8 bits for exponent and 0 bits for mantissa. The <code>ue8m0</code>â€‹ encoding does not support infinity.<sup>(ä¸æ”¯æŒæ— é™å¤§)</sup> NaNâ€‹ value is limited to â€‹0xff<sup>(NaNè¢«é™åˆ¶ä¸º0xff)</sup>â€‹. ue8m0â€‹ values must be used in a packed format specified as â€‹ue8m0x2<sup>(ue8m0å€¼å¿…é¡»ä»¥æŒ‡å®šçš„æ‰“åŒ…æ ¼å¼ue8m0x2ä½¿ç”¨ã€‚åŒ…å«è¿ä¸ªue8m0 çš„å¯„å­˜å™¨å¿…é¡»å£°æ˜ä¸º.b16ç±»å‹)</sup>â€‹. A register variable containing two <code>ue8m0</code>â€‹ values must be declared with <code>.b16</code>â€‹ type.</p>
<p>â€‹<code>ue4m3</code>â€‹ <strong>data format</strong>:This data format is a 7-bit unsigned floating-point format with 4 bits for exponent and 3 bits for mantissa. The <code>ue4m3</code>â€‹ encoding does not support infinity<sup>(åŒæ ·çš„ä¸æ”¯æŒæ— é™å¤§)</sup>. NaNâ€‹ value is limited to â€‹0x7f<sup>(NaNè¢«é™åˆ¶ä¸º0x7f)</sup>â€‹. A register variable containing single <code>ue4m3</code>â€‹ value must be declared with <code>.b8</code>â€‹ type having MSB bit padded with zero.</p>
<p>Alternate data formats cannot be used as fundamental types. They are supported as source or destination formats by certain instructions.<sup>(æ›¿ä»£æ•°æ®ä¸èƒ½ä½œä¸ºåŸºæœ¬ç±»å‹ä½¿ç”¨ã€‚å®ƒä»¬ä»…åœ¨æŸäº›æŒ‡ä»¤ä¸­ä½œä¸ºæºæ ¼å¼æˆ–ç›®æ ‡æ ¼å¼æ”¯æŒ)</sup></p>
<p>â€‹<img src="http://127.0.0.1:3622/assets/image-20250220155752-i63t9u0.png"
	
	
	
	loading="lazy"
	
		alt="image"
	
	
>â€‹</p>
<h3 id="24-packed-data-types">2.4 Packed Data Types
</h3><p>Certain PTX instructions operate on two or more sets of inputs in parallel, and produce two or more outputs<sup>(æŸäº›PTXæŒ‡ä»¤å¹¶è¡Œå¤„ç†ä¸¤ä¸ªæˆ–å¤šä¸ªè¾“å…¥é›†ï¼Œå¹¶ç”Ÿæˆä¸¤ä¸ªæˆ–å¤šä¸ªè¾“å‡ºã€‚æ­¤ç±»æŒ‡ä»¤å¯ä»¥ä½¿ç”¨ä»¥æ‰“åŒ…æ ¼å¼å­˜å‚¨çš„æ•°æ®ã€‚)</sup>. Such instructions can use the data stored in a packed format. PTX supports packing two or four values of the same scalar data type into a single, larger value<sup>(PTXæ”¯æŒå°†ä¸¤ä¸ªæˆ–å››ä¸ªç›¸åŒæ ‡é‡æ•°æ®ç±»å‹çš„å€¼æ‰“åŒ…æˆä¸€ä¸ªå•ä¸€çš„ã€æ›´å¤§çš„å€¼ã€‚)</sup>. The packed value is considered as a value of a <em>packed data type</em>. In this section we describe the packed data types supported in PTX.</p>
<h4 id="241-packed-floating-point-data-types">2.4.1 Packed Floating Point Data Types
</h4><p>PTX supports various variants of packed floating point data types<sup>(PTXæ”¯æŒè®¸å¤špacked æµ®ç‚¹æ•°æ®ç±»å‹ï¼Œå¦‚ä¸‹table9æ‰€ç¤º)</sup>. Out of them, only â€‹.f16x2â€‹ is supported as a fundamental type<sup>(åªæœ‰.f16x2è¢«æ”¯æŒä¸ºåŸºæœ¬ç±»å‹)</sup>, while others cannot be used as fundamental types - they are supported as instruction types on certain instructions<sup>(ä¸èƒ½ä½œä¸ºåŸºæœ¬ç±»å‹çš„packed data typesåªèƒ½åœ¨æŸäº›æŒ‡ä»¤ä¸­ä½œä¸ºæŒ‡ä»¤ç±»å‹å¾—åˆ°æ”¯æŒã€‚)</sup>. When using an instruction with such non-fundamental types, the operand data variables must be of bit type of appropriate size. For example, all of the operand variables must be of type <code>.b32</code>â€‹ for an instruction with instruction type as <code>.bf16x2</code>â€‹. <a class="link" href="https://docs.nvidia.com/cuda/parallel-thread-execution/index.html#operand-types-for-packed-floating-point-instruction-type"  target="_blank" rel="noopener"
    >Table 9</a> described various variants of packed floating point data types in PTX.</p>
<p>â€‹<img src="http://127.0.0.1:3622/assets/image-20250222145300-kqdwcxg.png"
	
	
	
	loading="lazy"
	
		alt="image"
	
	
>â€‹</p>
<h4 id="242-packed-integer-data-types">2.4.2 Packed Integer Data Types
</h4><p>PTX supports two variants of packed integer data types: â€‹.u16x2â€‹ and â€‹.s16x2<sup>(å’Œæµ®ç‚¹æ•°ä¸åŒï¼ŒPTXåªæ”¯æŒä¸¤ç§packed æ•´æ•°æ•°æ®ç±»å‹ï¼š.u16x2å’Œ.s16x2)</sup>â€‹. The packed data type consists of two <code>.u16</code>â€‹ or <code>.s16</code>â€‹ values. A register variable containing â€‹.u16x2â€‹ or â€‹.s16x2â€‹ data must be declared with â€‹.b32â€‹ type<sup>(åŒ…å« .u16x2 æˆ– .s16x2 æ•°æ®çš„å¯„å­˜å™¨å˜é‡å¿…é¡»å£°æ˜ä¸º .b32 ç±»å‹ã€‚æ‰“åŒ…æ•´æ•°æ•°æ®ç±»å‹ä¸èƒ½ä½œä¸ºåŸºæœ¬ç±»å‹ä½¿ç”¨ã€‚å®ƒä»¬ä»…åœ¨æŸäº›æŒ‡ä»¤ä¸­ä½œä¸ºæŒ‡ä»¤ç±»å‹å¾—åˆ°æ”¯æŒã€‚)</sup>. Packed integer data types cannot be used as fundamental types. They are supported as instruction types on certain instructions.</p>
<h2 id="3-texture-sampler-and-surface-typesä¼¼ä¹ä¸æ•°å€¼è®¡ç®—è¿™ä¸ªæ–¹å‘æ²¡æœ‰å¤ªå¤§çš„å…³ç³»æš‚ä¸”æ²¡çœ‹ä½†æ˜¯ä¸ºäº†ä¿æŒptxå­¦ä¹ çš„å®Œæ•´æ€§è¿˜æ˜¯cväº†ä¸Šå»">3. Texture Sampler and Surface Types<sup>(ä¼¼ä¹ä¸æ•°å€¼è®¡ç®—è¿™ä¸ªæ–¹å‘æ²¡æœ‰å¤ªå¤§çš„å…³ç³»ï¼Œæš‚ä¸”æ²¡çœ‹ï¼Œä½†æ˜¯ä¸ºäº†ä¿æŒPTXå­¦ä¹ çš„å®Œæ•´æ€§ï¼Œè¿˜æ˜¯CVäº†ä¸Šå»)</sup>
</h2><p>PTX includes built-in â€‹<em>opaque</em>â€‹ types<sup>(PTXæœ‰å†…ç½®çš„ä¸é€æ˜ç±»å‹ï¼Œç”¨äºå®šä¹‰çº¹ç†ã€é‡‡é›†å™¨å’Œè¡¨é¢æè¿°ç¬¦å˜é‡ã€‚)</sup> for defining texture, sampler, and surface descriptor variables. These types have named fields similar to structures, but all information about layout, field ordering, base address, and overall size is hidden to a PTX program, hence the term â€‹<em>opaque<sup>(ä½†æ˜¯æ‰€æœ‰ä¸é€æ˜ç±»å‹å…³äºå¸ƒå±€ã€å­—æ®µé¡ºåºã€åŸºå€å’Œæ•´ä½“å¤§å°çš„ä¿¡æ¯å¯¹äºPTXç¨‹åºéƒ½æ˜¯éšè—çš„ï¼Œå› æ­¤ç§°ä¸ºä¸é€æ˜ç±»å‹ã€‚)</sup></em>. The use of these opaque types is limited to<sup>(ä½¿ç”¨è¿™äº›ä¸é€æ˜ç±»å‹çš„èŒƒå›´ä»…é™äº)</sup>:</p>
<ul>
<li>Variable definition within global (module) scope and in kernel entry parameter lists.</li>
<li>Static initialization of module-scope variables using comma-delimited static assignment expressions for the named members of the type.</li>
<li>Referencing textures, samplers, or surfaces via texture and surface load/store instructions (<code>tex</code>â€‹, <code>suld</code>â€‹, <code>sust</code>â€‹, <code>sured</code>â€‹).</li>
<li>Retrieving the value of a named member via query instructions (<code>txq</code>â€‹, <code>suq</code>â€‹).</li>
<li>Creating pointers to opaque variables using <code>mov</code>â€‹, e.g., <code>mov.u64 reg, opaque_var;</code>â€‹. The resulting pointer may be stored to and loaded from memory, passed as a parameter to functions, and de-referenced by texture and surface load, store, and query instructions, but the pointer cannot otherwise be treated as an address, i.e., accessing the pointer with <code>ld</code>â€‹ and <code>st</code>â€‹ instructions, or performing pointer arithmetic will result in undefined results.</li>
<li>Opaque variables may not appear in initializers, e.g., to initialize a pointer to an opaque variable.</li>
</ul>
<h3 id="31-texture-and-surface-properties">3.1 Texture and Surface Properties
</h3><p>Fields <code>width</code>â€‹, <code>height</code>â€‹, and <code>depth</code>â€‹ specify the size of the texture or surface in number of elements in each dimension.</p>
<p>The <code>channel_data_type</code>â€‹ and <code>channel_order</code>â€‹ fields specify these properties of the texture or surface using enumeration types corresponding to the source language API. For example, see <a class="link" href="https://docs.nvidia.com/cuda/parallel-thread-execution/index.html#channel-data-type-and-channel-order-fields"  target="_blank" rel="noopener"
    >Channel Data Type and Channel Order Fields</a> for the OpenCL enumeration types currently supported in PTX.</p>
<h3 id="32-sampler-properties">3.2 Sampler Properties
</h3><p>The <code>normalized_coords</code>â€‹ field indicates whether the texture or surface uses normalized coordinates in the range [0.0, 1.0) instead of unnormalized coordinates in the range [0, N). If no value is specified, the default is set by the runtime system based on the source language.</p>
<p>The <code>filter_mode</code>â€‹ field specifies how the values returned by texture reads are computed based on the input texture coordinates.</p>
<p>The <code>addr_mode_{0,1,2}</code>â€‹ fields define the addressing mode in each dimension, which determine how out-of-range coordinates are handled.</p>
<p>See the <em>CUDA C++ Programming Guide</em> for more details of these properties.</p>
<p>â€‹<img src="http://127.0.0.1:3622/assets/image-20250222150628-2eakxgh.png"
	
	
	
	loading="lazy"
	
		alt="image"
	
	
>â€‹</p>
<p>In independent texture mode, the sampler properties are carried in an independent <code>.samplerref</code>â€‹ variable, and these fields are disabled in the <code>.texref</code>â€‹ variables. One additional sampler property, <code>force_unnormalized_coords</code>â€‹, is available in independent texture mode.</p>
<p>The <code>force_unnormalized_coords</code>â€‹ field is a property of <code>.samplerref</code>â€‹ variables that allows the sampler to override the texture header <code>normalized_coords</code>â€‹ property. This field is defined only in independent texture mode. When <code>True</code>â€‹, the texture header setting is overridden and unnormalized coordinates are used; when <code>False</code>â€‹, the texture header setting is used.</p>
<p>The <code>force_unnormalized_coords</code>â€‹ property is used in compiling OpenCL; in OpenCL, the property of normalized coordinates is carried in sampler headers. To compile OpenCL to PTX, texture headers are always initialized with <code>normalized_coords</code>â€‹ set to True, and the OpenCL sampler-based <code>normalized_coords</code>â€‹ flag maps (negated) to the PTX-level <code>force_unnormalized_coords</code>â€‹ flag.</p>
<p>Variables using these types may be declared at module scope or within kernel entry parameter lists. At module scope, these variables must be in the <code>.global</code>â€‹ state space. As kernel parameters, these variables are declared in the <code>.param</code>â€‹ state space.</p>
<p><strong>Example</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">.global .texref     my_texture_name;
</span></span><span class="line"><span class="cl">.global .samplerref my_sampler_name;
</span></span><span class="line"><span class="cl">.global .surfref    my_surface_name;
</span></span></code></pre></td></tr></table>
</div>
</div><p>When declared at module scope, the types may be initialized using a list of static expressions assigning values to the named members.</p>
<p><strong>Example</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">.global .texref tex1;
</span></span><span class="line"><span class="cl">.global .samplerref tsamp1 = { addr_mode_0 = clamp_to_border,
</span></span><span class="line"><span class="cl">                               filter_mode = nearest
</span></span><span class="line"><span class="cl">                             };
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="33-channel-data-type-and-channel-order-fields">3.3 Channel Data Type and Channel Order Fields
</h3><p>The <code>channel_data_type</code>â€‹ and <code>channel_order</code>â€‹ fields have enumeration types corresponding to the source language API. Currently, OpenCL is the only source language that defines these fields. <a class="link" href="https://docs.nvidia.com/cuda/parallel-thread-execution/index.html#channel-data-type-and-channel-order-fields-opencl-channel-order-definition"  target="_blank" rel="noopener"
    >Table 13</a> and <a class="link" href="https://docs.nvidia.com/cuda/parallel-thread-execution/index.html#channel-data-type-and-channel-order-fields-opencl-channel-data-type-definition"  target="_blank" rel="noopener"
    >Table 12</a> show the enumeration values defined in OpenCL version 1.0 for channel data type and channel order.</p>
<p>â€‹<img src="http://127.0.0.1:3622/assets/image-20250222150727-75ijm2w.png"
	
	
	
	loading="lazy"
	
		alt="image"
	
	
>â€‹</p>
<p>â€‹<img src="http://127.0.0.1:3622/assets/image-20250222150740-az3tjv4.png"
	
	
	
	loading="lazy"
	
		alt="image"
	
	
>â€‹</p>
<h2 id="4-variables">4. Variables
</h2><p>In PTX, a variable declaration describes both the variableâ€™s type and its state space<sup>(PTXä¸­çš„ä¸€ä¸ªå˜é‡å£°æ˜åŒæ—¶æè¿°äº†å˜é‡çš„ç±»å‹å’Œå…¶çŠ¶æ€ç©ºé—´ã€‚)</sup>. In addition to fundamental types, PTX supports types for simple aggregate objects such as vectors and arrays<sup>(é™¤äº†åŸºæœ¬ç±»å‹ï¼ŒPTXè¿˜æ”¯æŒç”¨äºç®€å•èšåˆå¯¹è±¡çš„ç±»å‹ï¼Œå¦‚å‘é‡å’Œæ•°ç»„)</sup></p>
<h3 id="41-variable-declarations">4.1 Variable Declarations
</h3><p>All storage for data is specified with variable declarations. Every variable must reside in one of the state spaces<sup>(æ¯ä¸€ä¸ªå˜é‡éƒ½å¿…é¡»é©»ç•™åœ¨ä¸€ä¸ªstate spaceä¹‹ä¸­)</sup> enumerated in the previous section.</p>
<p>A variable declaration names the space in which the variable resides, its type and size, its name, an optional array size, an optional initializer, and an optional fixed address for the variable<sup>(å˜é‡å£°æ˜æŒ‡å®šäº†å˜é‡æ‰€åœ¨çš„ç©ºé—´ã€ç±»å‹å’Œå¤§å°ã€åç§°ï¼ˆå‰é¢è¿™äº›æ˜¯å¿…é¡»çš„ï¼‰ ä»¥ä¸‹æ˜¯å¯é€‰çš„ å¯é€‰çš„æ•°ç»„å¤§å°ã€å¯é€‰çš„åˆå§‹åŒ–å™¨ä»¥åŠå˜é‡çš„å¯é€‰å›ºå®šåœ°å€ã€‚)</sup>.</p>
<p>Predicate variables may only be declared in the register state space<sup>(è°“è¯å˜é‡åªèƒ½åœ¨å¯„å­˜å™¨state spaceä¸­å£°æ˜)</sup>.</p>
<p><strong>Examples</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="o">.</span><span class="n">global</span> <span class="o">.</span><span class="n">u32</span> <span class="n">loc</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">.</span><span class="n">reg</span>    <span class="o">.</span><span class="n">s32</span> <span class="n">i</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">.</span><span class="k">const</span>  <span class="o">.</span><span class="n">f32</span> <span class="n">bias</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="o">.</span><span class="n">global</span> <span class="o">.</span><span class="n">u8</span>  <span class="n">bg</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="o">.</span><span class="n">reg</span>    <span class="o">.</span><span class="n">v4</span> <span class="o">.</span><span class="n">f32</span> <span class="n">accel</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="o">.</span><span class="n">reg</span>    <span class="o">.</span><span class="n">pred</span> <span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">r</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="42-vectors">4.2 Vectors
</h3><p>Limited-length vector types are supported. Vectors of length 2 and 4 of any non-predicate fundamental type can be declared by prefixing the type with .v2â€‹ or â€‹.v4<sup>(å‘é‡çš„ä¸¤ç§ï¼Œä¸¤ä¸ªå…ƒç´ æˆ–è€…4ä¸ªå…ƒç´ )</sup>â€‹. Vectors must be based on a fundamental type, and they may reside in the register space. Vectors cannot exceed 128-bits in length; for example, .v4 .f64<sup>(.v4.f64çš„æ„æ€æ˜¯å››ä¸ªf64çš„æ„æ€ï¼Œé‚£ä¹ˆ4ä¸ªf64çš„æ€»é•¿åº¦å°±æ˜¯4*8=32å­—èŠ‚ï¼ˆ256ä½ï¼‰ã€‚è€ŒPTXè¦æ±‚å‘é‡çš„é•¿åº¦ä¸èƒ½è¶…è¿‡128ä½ï¼Œå³16å­—èŠ‚)</sup>â€‹ is not allowed. Three-element vectors may be handled by using a â€‹.v4â€‹ vector<sup>(ä¸‰ä¸ªå…ƒç´ çš„å‘é‡ä¹Ÿè¦ç”¨.v4æ¥å¤„ç†ï¼Œå…¶ä¸­ç¬¬å››ä¸ªå…ƒç´ æä¾›å¡«å……)</sup>, where the fourth element provides padding. This is a common case for three-dimensional grids, textures, etc.</p>
<p><strong>Examples</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">.global .v4 .f32 V;   // a length-4 vector of floats
</span></span><span class="line"><span class="cl">.shared .v2 .u16 uv;  // a length-2 vector of unsigned ints
</span></span><span class="line"><span class="cl">.global .v4 .b8  v;   // a length-4 vector of bytes
</span></span></code></pre></td></tr></table>
</div>
</div><p>By default, vector variables are aligned to a multiple of their overall sizeâ€‹ (vector length times base-type size)<sup>(é»˜è®¤æƒ…å†µä¸‹ï¼Œå‘é‡å˜é‡æŒ‰ç…§å…¶æ•´ä½“å¤§å°çš„å€æ•°å¯¹é½ï¼ˆå‘é‡é•¿åº¦ä¹˜ä»¥åŸºç±»å‹å¤§å°ï¼‰)</sup>, to enable vector load and store instructions<sup>(æœ‰ä¸€äº›éœ€è¦å¦‚æ­¤å¯¹é½çš„load å’ŒstoreæŒ‡ä»¤)</sup> which require addresses aligned to a multiple of the access size.</p>
<h3 id="43-array-declarations">4.3 Array Declarations
</h3><p>Array declarations are provided to allow the programmer to reserve space<sup>(æ•°ç»„å£°æ˜è¢«ç¨‹åºå‘˜ç”¨äºé¢„ç•™ç©ºé—´)</sup>. To declare an array, the variable name is followed with dimensional declarations<sup>(å˜é‡åä¹‹åè¦è·Ÿç»´åº¦å£°æ˜ï¼Œå’ŒCç±»ä¼¼)</sup> similar to fixed-size array declarations in C. The size of each dimension is a constant expression.<sup>(æ¯ä¸ªç»´åº¦çš„å¤§å°éƒ½æ˜¯ä¸€ä¸ªå¸¸é‡è¡¨è¾¾å¼)</sup></p>
<p><strong>Examples</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">.local  .u16 kernel[19][19];
</span></span><span class="line"><span class="cl">.shared .u8  mailbox[128];
</span></span></code></pre></td></tr></table>
</div>
</div><p>The size of the array specifies how many elements should be reserved<sup>(æ•°ç»„çš„å¤§å°æŒ‡å®šäº†åº”é¢„ç•™å¤šå°‘ä¸ªå…ƒç´ ã€‚)</sup>. For the declaration of array â€‹<em>kernel</em>â€‹ above, 19<em>19 = 361 halfwords are reserved<sup>(åœ¨ä¸Šé¢çš„kernelæ•°ç»„å£°æ˜ä¸­ï¼Œé¢„ç•™äº†19</em>19=361 halfï¼ˆ.u16ï¼‰)</sup>, for a total of 722 bytes.</p>
<p>When declared with an initializer, the first dimension of the array may be omitted. The size of the first array dimension is determined by the number of elements in the array initializer.<sup>(å½“æ•°ç»„å£°æ˜å¸¦æœ‰åˆå§‹åŒ–å™¨æ—¶ï¼Œå¯ä»¥çœç•¥æ•°ç»„çš„ç¬¬ä¸€ä¸ªç»´åº¦ã€‚ å°±åƒ.global .s32 offset[][2] = { {-1, 0}, {0, -1}, {1, 0}, {0, 1} }; ä»–è¿™é‡Œçš„å£°æ˜å°±çœç•¥äº†ç¬¬ä¸€ä¸ªç»´åº¦ï¼Œåªç»™å‡ºäº†ç¬¬äºŒä¸ªç»´åº¦2. æ­¤æ—¶ç¬¬ä¸€ä¸ªç»´åº¦çš„å¤§å°ç”±æ•°ç»„åˆå§‹åŒ–å™¨ä¸­çš„å…ƒç´ ä¸ªæ•°å†³å®š)</sup></p>
<p><strong>Examples</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">.global .u32 index[] = { 0, 1, 2, 3, 4, 5, 6, 7 };
</span></span><span class="line"><span class="cl">.global .s32 offset[][2] = { {-1, 0}, {0, -1}, {1, 0}, {0, 1} };
</span></span></code></pre></td></tr></table>
</div>
</div><p>Array â€‹<em>index</em>â€‹ has eight elements, and array â€‹*offset<sup>(è¿™å¥è¯åªæ˜¯å¯¹ä¸Šé¢ä¾‹å­çš„ä¸€ä¸ªç®€å•çš„æè¿°)</sup>*â€‹ is a 4x2 array.<sup>(è¿™å¥è¯åªæ˜¯å¯¹ä¸Šé¢ä¾‹å­çš„ä¸€ä¸ªç®€å•çš„æè¿°)</sup></p>
<h3 id="44-initializers">4.4 Initializers
</h3><p>Declared variables may specify an initial value using a syntax similar to C/C++, where the variable name is followed by an equals sign and the initial value or values for the variable. A scalar takes a single value, while vectors and arrays take nested lists of values inside of curly braces (the nesting matches the dimensionality of the declaration).</p>
<p>As in C, array initializers may be incomplete, i.e., the number of initializer elements may be less than the extent of the corresponding array dimension, with remaining array locations initialized to the default value for the specified array type<sup>(å’ŒCè¯­è¨€ä¸€æ ·ï¼Œæ•°ç»„åˆå§‹åŒ–å™¨å¯ä»¥æ˜¯æœªå®Œæˆçš„ï¼Œå³ï¼Œ åˆå§‹åŒ–å…ƒç´ çš„æ•°é‡å¯èƒ½å°‘äºç›¸åº”æ•°ç»„ç»´åº¦çš„å¤§å° å‰©ä½™çš„æ•°ç»„ä½ç½®å°†è¢«åˆå§‹åŒ–ä¸ºæŒ‡å®šæ•°ç»„ç±»å‹çš„é»˜è®¤å€¼)</sup>.</p>
<p><strong>Examples</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="o">.</span><span class="k">const</span>  <span class="o">.</span><span class="n">f32</span> <span class="n">vals</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mf">0.33</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.125</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="o">.</span><span class="n">global</span> <span class="o">.</span><span class="n">s32</span> <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">},</span> <span class="p">{</span><span class="mi">3</span><span class="p">}</span> <span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>is equivalent to</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="o">.</span><span class="k">const</span>  <span class="o">.</span><span class="n">f32</span> <span class="n">vals</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mf">0.33</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.125</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="o">.</span><span class="n">global</span> <span class="o">.</span><span class="n">s32</span> <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="p">{</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">},</span> <span class="p">{</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">}</span> <span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Currently, variable initialization is supported only for constant and global state spaces. Variables in constant and global state spaces with no explicit initializer are initialized to zero by default. Initializers are not allowed in external variable declarations.</p>
<p>Variable names appearing in initializers represent the address of the variable; this can be used to statically initialize a pointer to a variable. Initializers may also contain <em>var+offset</em> expressions, where <em>offset</em> is a byte offset added to the address of <em>var</em>. Only variables in <code>.global</code>â€‹ or <code>.const</code>â€‹ state spaces may be used in initializers. By default, the resulting address is the offset in the variableâ€™s state space (as is the case when taking the address of a variable with a <code>mov</code>â€‹ instruction). An operator, <code>generic()</code>â€‹, is provided to create a generic address for variables used in initializers.</p>
<p>Starting PTX ISA version 7.1, an operator <code>mask()</code>â€‹ is provided, where <code>mask</code>â€‹ is an integer immediate. The only allowed expressions in the <code>mask()</code>â€‹ operator are integer constant expression and symbol expression representing address of variable. The <code>mask()</code>â€‹ operator extracts <code>n</code>â€‹ consecutive bits from the expression used in initializers and inserts these bits at the lowest position of the initialized variable. The number <code>n</code>â€‹ and the starting position of the bits to be extracted is specified by the integer immediate <code>mask</code>â€‹. PTX ISA version 7.1 only supports extracting a single byte starting at byte boundary from the address of the variable. PTX ISA version 7.3 supports Integer constant expression as an operand in the <code>mask()</code>â€‹ operator.</p>
<p>Supported values for <code>mask</code>â€‹ are: 0xFF, 0xFF00, 0XFF0000, 0xFF000000, 0xFF00000000, 0xFF0000000000, 0xFF000000000000, 0xFF00000000000000.</p>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/cuda/">CUDA</a>
        
            <a href="/tags/ptx/">PTX</a>
        
            <a href="/tags/%E6%B1%87%E7%BC%96/">æ±‡ç¼–</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    <section class="article-lastmod">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



        <span>
            æœ€åæ›´æ–°äº Feb 23, 2025 20:00 &#43;0800
        </span>
    </section></footer>


    
        <link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI&#43;WdtXRGWt2kTvGFasHpSy3SV"crossorigin="anonymous"
            ><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG&#43;vnGctmUb0ZY0l8"crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"integrity="sha384-&#43;VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4&#43;/RRE05"crossorigin="anonymous"
                defer
                >
            </script><script>
    window.addEventListener("DOMContentLoaded", () => {
	const mainArticleElement = document.querySelector(".main-article");
        renderMathInElement(mainArticleElement, {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false },
                { left: "\\[", right: "\\]", display: true }
            ],
            ignoredClasses: ["gist"]
        });})
</script>

    
</article>

    

    

     
    
        
    <div class="disqus-container">
    <div id="disqus_thread"></div>
<script>
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "hugo-theme-stack" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>

<style>
    .disqus-container {
        background-color: var(--card-background);
        border-radius: var(--card-border-radius);
        box-shadow: var(--shadow-l1);
        padding: var(--card-padding);
    }
</style>

<script>
    window.addEventListener('onColorSchemeChange', (e) => {
        if (typeof DISQUS == 'object') {
            DISQUS.reset({
                reload: true
            });
        }
    })
</script>

    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2001 - 
        
        2025 Alfred Ben
    </section>
    
    <section class="powerby">
        
            éŸ§æ€§ä¸æ˜¯æ‡’æƒ°ï¼Œæ˜¯åšæŒ <br/>
        ä½¿ç”¨ <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> æ„å»º <br />
        ä¸»é¢˜ <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.30.0">Stack</a></b> ç”± <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> è®¾è®¡
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css">
<script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script>

<div id="aplayer"></div>

<script>
const home = "https://cben484.github.io/" ;
console.log(home);
const ap = new APlayer({
    container: document.getElementById('aplayer'),
    audio: [{
        name: 'å®‰é™',
        artist: 'å‘¨æ°ä¼¦',
        url: home + 'music/å®‰é™-å‘¨æ°ä¼¦/å®‰é™.flac',
        cover: home + 'music/å®‰é™-å‘¨æ°ä¼¦/èŒƒç‰¹è¥¿.jpg'
    }]
});
</script>
    </body>
</html>
